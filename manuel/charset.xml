<?xml version="1.0" encoding="UTF-8"?>
<!-- $Header: /var/lib/cvs/pgsql-fr/sgml/charset.sgml,v 1.12 2005/09/15 07:03:15 guillaume Exp $ -->

<chapter id="charset">
 <title>Localisation</title>

 <para>
  Ce chapitre décrit les fonctionnalités disponibles pour la localisation
  du point de vue de l'administrateur.
  <productname>PostgreSQL</productname> supporte la localisation en utilisant
  deux approches&nbsp;:

   <itemizedlist>
    <listitem>
     <para>
      Utiliser les fonctionnalités de locale du système d'exploitation pour 
      donner un ordonnancement de tri, formatage de chiffre, des messages
      traduits et autres aspects spécifiques à la locale.
     </para>
    </listitem>

    <listitem>
     <para>
      Donner un certain nombre de jeu de caractères différents définis dans le
      serveur <productname>PostgreSQL</productname>, y compris
      des jeux de caractères multi-bit pour permettre de stocker du texte dans
      toutes sortes de langues et offrir la traduction de jeu de caractère 
      entre serveur et client.
     </para>
    </listitem>
   </itemizedlist>
  </para>


 <sect1 id="locale">
  <title>Support de locale</title>
  
  <indexterm zone="locale"><primary>locale</primary></indexterm>

  <para>
   Le support de <firstterm>locale</firstterm> fait référence à une application
   respectant les préférences culturelles en ce qui concerne les alphabets,
   le tri, le format des nombres, etc.  <productname>PostgreSQL</productname> utilise
   les possibilités du standard ISO C et de la locale <acronym>POSIX</acronym>
   fourni par le système d'exploitation serveur. Pour plus d'informations,
   consultez la documentation de votre serveur.
  </para>

  <sect2>
   <title>Aperçu</title>

   <para>
    Le support de locale est automatiquement initialisé lorsqu'un cluster de 
    base de données est créé avec <command>initdb</command>.
    <command>initdb</command> va initialiser le cluster avec la valeur de
    locale de son environnement d'exécution par défaut. Donc, si votre 
    système est déjà paramétré pour utiliser la locale que vous voulez dans
    votre cluster, vous n'avez rien d'autre à faire. Si vous voulez utiliser
    une locale différente (ou si vous n'êtes pas sûr de la locale qu'utilise
    votre système), vous pouvez dire à <command>initdb</command> exactement
    quel locale utiliser en spécifiant l'option <option>--locale</option>.
    Par exemple&nbsp;:
<screen>initdb --locale=sv_SE</screen>
   </para>

   <para>
    Cette exemple met la locale en suédois (<literal>sv</literal>) tel que parlé en
    Suède (<literal>SE</literal>).  D'autres possibilités pourraient être
    <literal>en_US</literal> (l'anglais américain) et <literal>fr_CA</literal> (français
    canadien).  Si plus d'un jeu de caractères peuvent être utiles pour une
    locale, alors la spécification ressemble à ceci&nbsp;:
    <literal>cs_CZ.ISO8859-2</literal>. Quels locales sont disponibles sous quels
    noms dépend de l'éditeur de votre système d'exploitation et de ce qui est
    installé (sur la plupart des systèmes, la commande <literal>locale -a</literal>
    fournira une liste de locales disponibles).
   </para>

   <para>
    De façon occasionnelle, il est utile de mélanger les règles de plusieurs
    locales, i.e. utiliser les règles de tri anglais mais des messages en
    espagnol. Pour permettre ceci, des sous-catégories de locales existent
    qui ne contrôlent qu'un certain aspect des règles de localisation&nbsp;:

    <informaltable>
     <tgroup cols="2">
     <colspec colnum="1" colwidth="0.4*"/>
     <colspec colnum="2" colwidth="1.6*"/>
      <tbody>
       <row>
        <entry><envar>LC_COLLATE</envar></entry>
        <entry>Ordre de tri des chaînes de caractères</entry>
       </row>
       <row>
        <entry><envar>LC_CTYPE</envar></entry>
        <entry>Classification de caractères (Qu'est-ce qu'une lettre&nbsp;?
         La majuscule équivalente&nbsp;?)</entry>
       </row>
       <row>
        <entry><envar>LC_MESSAGES</envar></entry>
        <entry>Langage des messages</entry>
       </row>
       <row>
        <entry><envar>LC_MONETARY</envar></entry>
        <entry>Formatage des montants de monnaie</entry>
       </row>
       <row>
        <entry><envar>LC_NUMERIC</envar></entry>
        <entry>Formatage des nombres</entry>
       </row>
       <row>
        <entry><envar>LC_TIME</envar></entry>
        <entry>Formatage des dates et heures</entry>
       </row>
      </tbody>
     </tgroup>
    </informaltable>

    Les noms des catégories se traduisent en noms d'options
    <command>initdb</command> pour surcharger le choix de locale
    pour une catégorie donnée. Par exemple, pour mettre la locale en
    français canadien tout en utilisant les règles américaines pour le
    formatage de monnaie, utilisez
    <literal>initdb --locale=fr_CA --lc-monetary=en_US</literal>.
   </para>

   <para>
    Pour obtenir que le système se comporte comme s'il n'avait pas de
    support de locale, on utilise les locales spéciales <literal>C</literal> ou
    <literal>POSIX</literal>.
   </para>

   <para>
    La nature de ces catégories de locales est que leur valeur doit être
    fixe pour la durée de vie d'un cluster de base de données.
    C'est-à-dire qu'une fois <command>initdb</command> lancée, on ne peut
    plus les changer.
    <literal>LC_COLLATE</literal> et <literal>LC_CTYPE</literal> sont ces
    catégories. Ils affectent l'ordre de tri des index, donc ils doivent
    rester fixes ou les index sur les colonnes de texte deviendront
    corrompus.
    <productname>PostgreSQL</productname> applique ceci en enregistrant
    les valeurs de <envar>LC_COLLATE</envar> et <envar>LC_CTYPE</envar> qui sont vus
    par <command>initdb</command>. Le serveur adopte automatiquement ces deux
    valeurs lorsqu'il est exécuté.
   </para>

   <para>
    Les autres catégories de locale peuvent être changées comme désiré lorsque
    le serveur est lancé en fixant les variables d'environnement qui ont le
    même nom que les catégories de locale (voir la <xref
    linkend="runtime-config-client-format"/> pour plus de détails). Les 
    valeurs par défaut choisies par <command>initdb</command> sont en fait
    seulement écrites dans le fichier de configuration
    <filename>postgresql.conf</filename> pour servir de valeur par défaut
    quand le serveur est lancé. Si vous effacez ces déclarations de
    <filename>postgresql.conf</filename>, alors le serveur
    héritera des paramètres de son environnement d'exécution.
   </para>

   <para>
    Notez que le comportement de locale du serveur est déterminé par les
    variables d'environnement vues par le serveur, pas l'environnement d'un
    client quelconque. Alors, faites attention de configurer les bons
    paramètres de locale avant de lancer le serveur. Une conséquence de ceci
    est que, si le client et le serveur ont des locales différentes, les
    messages apparaîtront dans des langues différentes suivant d'où ils
    viennent.
   </para>

   <note>
    <para>
     Lorsqu'on parle d'hériter la locale de l'environnement d'exécution, ceci
     veut dire la chose suivante sur la plupart des systèmes
     d'exploitation&nbsp;: pour une catégorie de locale donnée, disons
     l'ordonnancement, les variables d'environnement suivantes sont
     consultées dans cet ordre jusqu'à ce qu'on en trouve une de fixée&nbsp;:
     <envar>LC_ALL</envar>, <envar>LC_COLLATE</envar> (la variable
     correspondante à la catégorie respective), <envar>LANG</envar>. Si aucune
     de ces variables n'est fixée, alors on utilise la locale par défaut de
     <literal>C</literal>.
    </para>

    <para>
     Certaines bibliothèques de localisation regardent aussi la variable
     d'environnement <envar>LANGUAGE</envar> qui surcharge tout autre
     paramètre pour le besoin de fixer la langue des messages. Si vous
     doutez, lisez la documentation de votre système d'exploitation,
     en particulier la documentation à propos de
     <application>gettext</application>, pour plus d'information.
    </para>
   </note>

   <para>
    Pour permettre la traduction des messages dans la langue préférée de
    l'utilisateur, <acronym>NLS</acronym> doit être activé pendant la
    compilation. Ce choix est indépendant d'autre support de locale.
   </para>
  </sect2>

  <sect2>
   <title>Comportement</title>

   <para>
    Le paramétrage de la locale influence les fonctionnalités SQL
    suivantes&nbsp;:

    <itemizedlist>
     <listitem>
      <para>
       Ordre de tri dans les requêtes utilisant <literal>ORDER BY</literal> sur des
       données de type texte
       <indexterm><primary>ORDER BY</primary><secondary>et les locales</secondary></indexterm>
      </para>
     </listitem>

     <listitem>
      <para>
       La possibilité d'utiliser des index avec les clauses <literal>LIKE</literal>
       <indexterm><primary>LIKE</primary><secondary>et les locales</secondary></indexterm>
      </para>
     </listitem>

     <listitem>
      <para>
       Les fonctions <function>upper</function>, <function>lower</function> et
       <function>initcap</function>
       <indexterm><primary>upper</primary><secondary>et les locales</secondary></indexterm>
       <indexterm><primary>lower</primary><secondary>et les locales</secondary></indexterm>
      </para>
     </listitem>

     <listitem>
      <para>
       La famille de fonctions <function>to_char</function>
       <indexterm><primary>to_char</primary><secondary>et les locales</secondary></indexterm>
      </para>
     </listitem>
    </itemizedlist>
   </para>

   <para>
    L'inconvénient d'utiliser le support de locale autres que <literal>C</literal> ou
    <literal>POSIX</literal> dans <productname>PostgreSQL</productname> est son impact sur les
    performances. Il ralentit la gestion des caractères et empêche 
    l'utilisation des index ordinaires par <literal>LIKE</literal>. Pour cette
    raison, il est recommandé de n'utiliser les locales que lorsque cela est réellement nécessaire.
   </para>

   <para>
    Comme contournement pour que <productname>PostgreSQL</productname> puisse utiliser
    des index avec les clauses <literal>LIKE</literal> et une locale autre que C,
    plusieurs classes d'opérateurs personnalisés existent. Elles permettent
    la création d'un index qui fait une comparaison stricte, caractère par
    caractère, ignorant les règles de comparaison des locales. Référez-vous à
    la <xref linkend="indexes-opclass"/> pour plus d'informations.
   </para>
  </sect2>

  <sect2>
   <title>Problèmes</title>

   <para>
    Si le support de locale ne fonctionne pas malgré l'explication ci-dessus,
    vérifiez que le support de locale de votre système d'exploitation est
    correctement configuré. Pour vérifier quelles locales sont installées sur
    votre système, vous pouvez utiliser la commande <literal>locale 
    -a</literal> si votre système d'exploitation la fournit.
   </para>

   <para>
    Vérifiez que <productname>PostgreSQL</productname> utilise vraiment la 
    locale que vous supposez. Les paramètres <envar>LC_COLLATE</envar> et
    <envar>LC_CTYPE</envar> sont déterminés lors de <command>initdb</command>
    et ne peuvent pas être modifiés sans répéter <command>initdb</command>.
    D'autres paramètres de locale, y compris <envar>LC_MESSAGES</envar> et
    <envar>LC_MONETARY</envar>, sont déterminés initialement par
    l'environnement dans lequel le serveur est lancé mais peut être modifié
    en cours. Vous pouvez vérifier les paramétrages de la locale active en
    utilisant la commande <command>SHOW</command>.
   </para>

   <para>
    Le répertoire <filename>src/test/locale</filename> dans la distribution 
    du source contient une série de tests pour le support de locale dans
    <productname>PostgreSQL</productname>.
   </para>

   <para>
    Les applications clientes qui gèrent les erreurs côté serveur en 
    analysant le texte
    du message d'erreur auront, bien sûr, des problèmes lorsque les messages
    sont dans une langue différente. Les auteurs de telles applications sont
    invités à utiliser le schéma de code d'erreur à la place.
   </para>

   <para>
    Maintenir des catalogues de traductions de messages requiert les
    efforts permanents de beaucoup de volontaires qui souhaitent voir
    <productname>PostgreSQL</productname> bien interpréter leur langue 
    préférée. Si des messages dans votre langue ne sont pas disponibles ou
    pas complètement
    traduits, votre aide serait très appréciée. Si vous voulez aider,
    consultez le <xref linkend="nls"/> ou écrivez à la liste de diffusion des
    développeurs.
   </para>
  </sect2>
 </sect1>


 <sect1 id="multibyte">
  <title>Support des jeux de caractères</title>

  <indexterm zone="multibyte"><primary>jeu de caractère</primary></indexterm>

  <para>
   Le support des jeux de caractères dans <productname>PostgreSQL</productname>
   vous permet de rentrer du texte dans plusieurs jeux de caractères, dont
   des jeux de caractères à un octet tels que la série ISO 8859 et
   des jeux de caractères multi-octets tel que <acronym>EUC</acronym> 
   (Extended Unix Code), UTF-8 et le code interne de Mule. Tous les jeux de
   caractères supportés peuvent être utilisés de façon transparente par les
   clients mais certains ne sont pas supportés au sein du serveur (c'est-à-dire
   comme jeu de caractères du serveur).
   Le jeu de caractères par défaut est sélectionné pendant l'initialisation de
   votre cluster de base de données <productname>PostgreSQL</productname>
   avec <command>initdb</command>.  Le choix peut être outrepassé lors de la
   création de la base, vous pouvez donc avoir des bases avec des jeux de
   caractères différents.
  </para>

   <sect2 id="multibyte-charset-supported">
    <title>Jeux de caractères supportés</title>

    <para>
     Le <xref linkend="charset-table"/> montre les jeux de caractères disponibles
     à l'utilisation dans <productname>PostgreSQL</productname>.
    </para>

     <table id="charset-table">
      <title>Jeux de caractères de <productname>PostgreSQL</productname></title>
      <tgroup cols="6">
       <colspec colnum="1" colwidth="0.8*"/>
       <colspec colnum="2" colwidth="1.4*"/>
       <colspec colnum="3" colwidth="1*"/>
       <colspec colnum="4" colwidth="1*"/>
       <colspec colnum="5" colwidth="0.7*"/>
       <colspec colnum="6" colwidth="1.1*"/>
       <thead>
        <row>
         <entry>Nom</entry>
         <entry>Description</entry>
	 <entry>Langue</entry>
         <entry>Serveur</entry>
         <!--
          The Bytes/Char field is populated by looking at the values returned
          by pg_wchar_table.mblen function for each encoding.
         -->
         <entry>Octets/Caractère</entry>
         <entry>Alias</entry>
        </row>
       </thead>
       <tbody>
        <row>
         <entry><literal>BIG5</literal></entry>
         <entry>Big Five</entry>
         <entry>Chinois traditionnel</entry>
	 <entry>Non</entry>
         <entry>1-2</entry>
         <entry><literal>WIN950</literal>, <literal>Windows950</literal></entry>
        </row>
        <row>
         <entry><literal>EUC_CN</literal></entry>
         <entry>Code-CN Unix étendu</entry>
	 <entry>Chinois simplifié</entry>
	 <entry>Oui</entry>
         <entry>1-3</entry>
         <entry></entry>
        </row>
        <row>
         <entry><literal>EUC_JP</literal></entry>
         <entry>Code-JP Unix étendu</entry>
	 <entry>Japonais</entry>
	 <entry>Oui</entry>
         <entry>1-3</entry>
         <entry></entry>
        </row>
        <row>
         <entry><literal>EUC_KR</literal></entry>
         <entry>Code-KR Unix étendu</entry>
	 <entry>Coréen</entry>
	 <entry>Oui</entry>
         <entry>1-3</entry>
         <entry></entry>
        </row>
        <row>
         <entry><literal>EUC_TW</literal></entry>
         <entry>Code-TW Unix étendu</entry>
	 <entry>Chinois traditionnel, taïwanais</entry>
	 <entry>Oui</entry>
         <entry>1-3</entry>
         <entry></entry>
        </row>
        <row>
         <entry><literal>GB18030</literal></entry>
         <entry>Standard national</entry>
	 <entry>Chinois</entry>
	 <entry>Non</entry>
         <entry>1-2</entry>
         <entry></entry>
        </row>
        <row>
         <entry><literal>GBK</literal></entry>
         <entry>Standard national étendu</entry>
	 <entry>Chinois simplifié</entry>
	 <entry>Non</entry>
         <entry>1-2</entry>
         <entry><literal>WIN936</literal>, <literal>Windows936</literal></entry>
        </row>
        <row>
         <entry><literal>ISO_8859_5</literal></entry>
         <entry>ISO 8859-5, <acronym>ECMA</acronym> 113</entry>
	 <entry>Latin/Cyrillique</entry>
	 <entry>Oui</entry>
         <entry>1</entry>
         <entry></entry>
        </row>
        <row>
         <entry><literal>ISO_8859_6</literal></entry>
         <entry>ISO 8859-6, <acronym>ECMA</acronym> 114</entry>
	 <entry>Latin/Arabe</entry>
	 <entry>Oui</entry>
         <entry>1</entry>
         <entry></entry>
        </row>
        <row>
         <entry><literal>ISO_8859_7</literal></entry>
         <entry>ISO 8859-7, <acronym>ECMA</acronym> 118</entry>
	 <entry>Latin/Grec</entry>
	 <entry>Oui</entry>
         <entry>1</entry>
         <entry></entry>
        </row>
        <row>
         <entry><literal>ISO_8859_8</literal></entry>
         <entry>ISO 8859-8, <acronym>ECMA</acronym> 121</entry>
	 <entry>Latin/Hébreu</entry>
	 <entry>Oui</entry>
         <entry>1</entry>
         <entry></entry>
        </row>
        <row>
         <entry><literal>JOHAB</literal></entry>
         <entry><acronym>JOHAB</acronym></entry>
	 <entry>Koréen (Hangul)</entry>
	 <entry>Oui</entry>
         <entry>1-3</entry>
         <entry></entry>
        </row>
        <row>
         <entry><literal>KOI8</literal></entry>
         <entry><acronym>KOI</acronym>8-R(U)</entry>
	 <entry>Cyrillique</entry>
	 <entry>Oui</entry>
         <entry>1</entry>
         <entry><literal>KOI8R</literal></entry>
        </row>
        <row>
         <entry><literal>LATIN1</literal></entry>
         <entry>ISO 8859-1, <acronym>ECMA</acronym> 94</entry>
	 <entry>Europe de l'ouest</entry>
	 <entry>Oui</entry>
         <entry>1</entry>
         <entry><literal>ISO88591</literal></entry>
        </row>
        <row>
         <entry><literal>LATIN2</literal></entry>
         <entry>ISO 8859-2, <acronym>ECMA</acronym> 94</entry>
	 <entry>Europe centrale</entry>
	 <entry>Oui</entry>
         <entry>1</entry>
         <entry><literal>ISO88592</literal></entry>
        </row>
        <row>
         <entry><literal>LATIN3</literal></entry>
         <entry>ISO 8859-3, <acronym>ECMA</acronym> 94</entry>
	 <entry>Europe du sud</entry>
	 <entry>Oui</entry>
         <entry>1</entry>
         <entry><literal>ISO88593</literal></entry>
        </row>
        <row>
         <entry><literal>LATIN4</literal></entry>
         <entry>ISO 8859-4, <acronym>ECMA</acronym> 94</entry>
	 <entry>Europe du nord</entry>
	 <entry>Oui</entry>
         <entry>1</entry>
         <entry><literal>ISO88594</literal></entry>
        </row>
        <row>
         <entry><literal>LATIN5</literal></entry>
         <entry>ISO 8859-9, <acronym>ECMA</acronym> 128</entry>
	 <entry>Turque</entry>
	 <entry>Oui</entry>
         <entry>1</entry>
         <entry><literal>ISO88599</literal></entry>
        </row>
        <row>
         <entry><literal>LATIN6</literal></entry>
         <entry>ISO 8859-10, <acronym>ECMA</acronym> 144</entry>
	 <entry>Nordique</entry>
	 <entry>Oui</entry>
         <entry>1</entry>
         <entry><literal>ISO885910</literal></entry>
        </row>
        <row>
         <entry><literal>LATIN7</literal></entry>
         <entry>ISO 8859-13</entry>
	 <entry>Baltique</entry>
	 <entry>Oui</entry>
         <entry>1</entry>
         <entry><literal>ISO885913</literal></entry>
        </row>
        <row>
         <entry><literal>LATIN8</literal></entry>
         <entry>ISO 8859-14</entry>
	 <entry>Celtique</entry>
	 <entry>Oui</entry>
         <entry>1</entry>
         <entry><literal>ISO885914</literal></entry>
        </row>
        <row>
         <entry><literal>LATIN9</literal></entry>
         <entry>ISO 8859-15</entry>
	 <entry>LATIN1 avec l'Euro et les accents</entry>
	 <entry>Oui</entry>
         <entry>1</entry>
         <entry>ISO885915</entry>
        </row>
        <row>
         <entry><literal>LATIN10</literal></entry>
         <entry>ISO 8859-16, <acronym>ASRO</acronym> SR 14111</entry>
	 <entry>Roumain</entry>
	 <entry>Oui</entry>
         <entry>1</entry>
         <entry><literal>ISO885916</literal></entry>
        </row>
        <row>
         <entry><literal>MULE_INTERNAL</literal></entry>
         <entry>Code interne Mule</entry>
	 <entry>Emacs multi-langues</entry>
	 <entry>Oui</entry>
         <entry>1-4</entry>
         <entry></entry>
        </row>
        <row>
         <entry><literal>SJIS</literal></entry>
         <entry>Shift JIS</entry>
	 <entry>Japonais</entry>
	 <entry>Non</entry>
         <entry>1-2</entry>
         <entry><literal>Mskanji</literal>, <literal>ShiftJIS</literal>, <literal>WIN932</literal>, <literal>Windows932</literal></entry>
        </row>
        <row>
         <entry><literal>SQL_ASCII</literal></entry>
         <entry>non spécifié (voir le texte)</entry>
	 <entry><emphasis>tout</emphasis></entry>
	 <entry>Oui</entry>
         <entry>1</entry>
         <entry></entry>
        </row>
        <row>
         <entry><literal>UHC</literal></entry>
         <entry>Code unifié Hangul</entry>
	 <entry>Koréen</entry>
	 <entry>Non</entry>
         <entry>1-2</entry>
         <entry><literal>WIN949</literal>, <literal>Windows949</literal></entry>
        </row>
        <row>
         <entry><literal>UTF8</literal></entry>
         <entry>Unicode, 8-bit</entry>
	 <entry><emphasis>tous</emphasis></entry>
	 <entry>Oui</entry>
         <entry>1-4</entry>
         <entry><literal>Unicode</literal></entry>
        </row>
        <row>
         <entry><literal>WIN866</literal></entry>
         <entry>Windows CP866</entry>
	 <entry>Cyrillique</entry>
	 <entry>Oui</entry>
         <entry>1</entry>
         <entry><literal>ALT</literal></entry>
        </row>
        <row>
         <entry><literal>WIN874</literal></entry>
         <entry>Windows CP874</entry>
	 <entry>Thai</entry>
	 <entry>Oui</entry>
         <entry>1</entry>
         <entry></entry>
        </row>
        <row>
         <entry><literal>WIN1250</literal></entry>
         <entry>Windows CP1250</entry>
	 <entry>Europe centrale</entry>
	 <entry>Oui</entry>
         <entry>1</entry>
         <entry></entry>
        </row>
        <row>
         <entry><literal>WIN1251</literal></entry>
         <entry>Windows CP1251</entry>
	 <entry>Cyrillique</entry>
	 <entry>Oui</entry>
         <entry>1</entry>
         <entry><literal>WIN</literal></entry>
        </row>
        <row>
         <entry><literal>WIN1252</literal></entry>
         <entry>Windows CP1252</entry>
         <entry>Europe de l'ouest</entry>
         <entry>1</entry>
         <entry></entry>
        </row>
        <row>
         <entry><literal>WIN1256</literal></entry>
         <entry>Windows CP1256</entry>
	 <entry>Arabe</entry>
	 <entry>Oui</entry>
         <entry>1</entry>
         <entry></entry>
        </row>
        <row>
         <entry><literal>WIN1258</literal></entry>
         <entry>Windows CP1258</entry>
	 <entry>Vietnamien</entry>
	 <entry>Oui</entry>
         <entry>1</entry>
         <entry><literal>ABC</literal>, <literal>TCVN</literal>, <literal>TCVN5712</literal>, <literal>VSCII</literal></entry>
        </row>
       </tbody>
      </tgroup>
     </table>

     <para>
      Toutes les <acronym>API</acronym> ne supportent pas les jeux de caractères de
      la liste. Par exemple, le pilote JDBC de <productname>PostgreSQL</productname>
      ne supporte pas <literal>MULE_INTERNAL</literal>, <literal>LATIN6</literal>,
      <literal>LATIN8</literal> et <literal>LATIN10</literal>.
     </para>

     <para>
      La valeur <literal>SQL_ASCII</literal> se comporte de façon considérablement
      différente des autres valeurs. Quand l'ensemble de caractères du
      serveur est <literal>SQL_ASCII</literal>, le serveur interprète les valeurs
      des octets 0-127 suivant le standard ASCII alors que les valeurs
      d'octets 128-255 sont considérées comme des caractères non interprétés.
      Aucune conversion de codage ne sera effectuée avec
      <literal>SQL_ASCII</literal>. Du coup, cette valeur n'est pas tellement
      la déclaration qu'un codage spécifique est utilisé, mais plutôt de
      l'ignorance du codage. Dans la plupart des cas, si vous travaillez avec
      des données non ASCII, il est déconseillé d'utiliser la valeur
      <literal>SQL_ASCII</literal> car <productname>PostgreSQL</productname> sera
      incapable de vous aider dans la conversion ou la validation des
      caractères non ASCII.
     </para>
    </sect2>

   <sect2>
    <title>Choisir le jeu de caractères</title>

    <para>
     <command>initdb</command> définit le jeu de caractères par défaut
     pour un cluster <productname>PostgreSQL</productname>. Par exemple,

<screen>initdb -E EUC_JP</screen>

     paramètre le jeu de caractères (codage) à
     <literal>EUC_JP</literal> (Extended Unix Code for Japanese). Vous
     pouvez utiliser l'option <option>--encoding</option> au lieu de
     <option>-E</option> si vous préférez saisir les noms d'options longs.
     Si aucune option <option>-E</option> ou <option>--encoding</option> n'est
     donnée, <command>initdb</command> tente de déterminer le codage approprié à
     utiliser suivant la locale spécifiée ou par défaut.
    </para>

    <para>
     Vous pouvez créer une base de données avec un jeu de caractère
     différent&nbsp;:

<screen>createdb -E EUC_KR korean</screen>

     Ceci va créer une base de données appelée <literal>korean</literal> qui
     utilisera le jeu de caractère <literal>EUC_KR</literal>. Un autre moyen de
     réaliser ceci est d'utiliser cette commande SQL&nbsp;:

<programlisting>CREATE DATABASE korean WITH ENCODING 'EUC_KR';</programlisting>

     Le codage pour une base de données est conservé dans le catalogue système
     <literal>pg_database</literal>.  Vous pouvez voir ceci en utilisant 
     l'option <option>-l</option> ou la commande <command>\l</command> de
     <command>psql</command>.

<screen>$ <userinput>psql -l</userinput>
            List of databases
   Database    |  Owner  |   Encoding    
---------------+---------+---------------
 euc_cn        | t-ishii | EUC_CN
 euc_jp        | t-ishii | EUC_JP
 euc_kr        | t-ishii | EUC_KR
 euc_tw        | t-ishii | EUC_TW
 mule_internal | t-ishii | MULE_INTERNAL
 postgres      | t-ishii | EUC_JP
 regression    | t-ishii | SQL_ASCII
 template1     | t-ishii | EUC_JP
 test          | t-ishii | EUC_JP
 utf8          | t-ishii | UTF8
(9 rows)</screen>
    </para>

    <important>
    <para>
    Bien que vous pouvez spécifier tout codage que vous souhaitez pour une base
    de données, il est déconseillé de choisir un codage qui n'est pas attendu
    par la locale sélectionnée. Les paramètres <literal>LC_COLLATE</literal> et
    <literal>LC_CTYPE</literal> impliquent un codage particulier, et les
    opérations dépendantes de la locale (comme le tri) pourraient mal
    interpréter les données qui sont dans un codage incompatible.
    </para>

    <para>
    Comme ces paramètres de locale sont gelés par <command>initdb</command>, la
    flexibilité apparente pour utiliser différents codages dans les
    différentes bases de données d'un groupe est plus théorique que réel.
    Il est probable que ces mécanismes soient revus dans les prochaines
    versions de <productname>PostgreSQL</productname>.
    </para>

    <para>
    Une façon d'utiliser les codages multiples en toute sûreté est de 
    configurer la locale à <literal>C</literal> ou <literal>POSIX</literal> lors
    d'<command>initdb</command> désactivant toute connaissance réelle de la locale.
    </para>
    </important>
   </sect2>

   <sect2>
    <title>Conversion de jeu de caractères automatique entre serveur et client</title>

    <para>
     <productname>PostgreSQL</productname> supporte les conversions
     automatiques de jeu de caractères entre client et serveur pour
     certains jeux de caractères. Les informations de conversion sont
     conservées dans le catalogue système <literal>pg_conversion</literal>.
     <productname>PostgreSQL</productname> est livré avec certaines
     conversions prédéfinies, conversions listées dans le <xref
     linkend="multibyte-translation-table"/>. Vous pouvez créer une nouvelle
     conversion en utilisant la commande SQL <command>CREATE CONVERSION</command>.
    </para>

     <table id="multibyte-translation-table">
      <title>Conversion de jeux de caractères client/serveur</title>
      <tgroup cols="2">
       <colspec colnum="1" colwidth="0.5*"/>
       <colspec colnum="2" colwidth="1.5*"/>
       <thead>
	<row>
	 <entry>Jeu de caractères serveur</entry>
	 <entry>Jeux de caractères client disponibles</entry>
	</row>
       </thead>
       <tbody>
        <row>
         <entry><literal>BIG5</literal></entry>
         <entry><emphasis>non supporté comme codage serveur</emphasis>
         </entry>
        </row>
        <row>
         <entry><literal>EUC_CN</literal></entry>
         <entry><emphasis>EUC_CN</emphasis>,
         <literal>MULE_INTERNAL</literal>,
         <literal>UTF8</literal>
         </entry>
        </row>
        <row>
         <entry><literal>EUC_JP</literal></entry>
         <entry><emphasis>EUC_JP</emphasis>,
         <literal>MULE_INTERNAL</literal>,
         <literal>SJIS</literal>,
         <literal>UTF8</literal>
         </entry>
        </row>
        <row>
         <entry><literal>EUC_KR</literal></entry>
         <entry><emphasis>EUC_KR</emphasis>,
         <literal>MULE_INTERNAL</literal>,
         <literal>UTF8</literal>
         </entry>
        </row>
        <row>
         <entry><literal>EUC_TW</literal></entry>
         <entry><emphasis>EUC_TW</emphasis>,
         <literal>BIG5</literal>,
         <literal>MULE_INTERNAL</literal>,
         <literal>UTF8</literal>
         </entry>
        </row>
        <row>
         <entry><literal>GB18030</literal></entry>
         <entry><emphasis>non supporté comme codage serveur</emphasis>
         </entry>
        </row>
        <row>
         <entry><literal>GBK</literal></entry>
         <entry><emphasis>non supporté comme codage serveur</emphasis>
         </entry>
        </row>
        <row>
         <entry><literal>ISO_8859_5</literal></entry>
         <entry><emphasis>ISO_8859_5</emphasis>,
         <literal>KOI8</literal>,
         <literal>MULE_INTERNAL</literal>,
         <literal>UTF8</literal>,
         <literal>WIN866</literal>,
         <literal>WIN1251</literal>
         </entry>
        </row>
        <row>
         <entry><literal>ISO_8859_6</literal></entry>
         <entry><emphasis>ISO_8859_6</emphasis>,
         <literal>UTF8</literal>
         </entry>
        </row>
        <row>
         <entry><literal>ISO_8859_7</literal></entry>
         <entry><emphasis>ISO_8859_7</emphasis>,
         <literal>UTF8</literal>
         </entry>
        </row>
        <row>
         <entry><literal>ISO_8859_8</literal></entry>
         <entry><emphasis>ISO_8859_8</emphasis>,
         <literal>UTF8</literal>
         </entry>
        </row>
        <row>
         <entry><literal>JOHAB</literal></entry>
         <entry><emphasis>JOHAB</emphasis>,
         <literal>UTF8</literal>
         </entry>
        </row>
        <row>
         <entry><literal>KOI8</literal></entry>
         <entry><emphasis>KOI8</emphasis>,
         <literal>ISO_8859_5</literal>,
         <literal>MULE_INTERNAL</literal>,
         <literal>UTF8</literal>,
         <literal>WIN866</literal>,
         <literal>WIN1251</literal>
         </entry>
        </row>
        <row> 
         <entry><literal>LATIN1</literal></entry>
         <entry><emphasis>LATIN1</emphasis>,
         <literal>MULE_INTERNAL</literal>,
         <literal>UTF8</literal>
         </entry>
        </row>
        <row> 
         <entry><literal>LATIN2</literal></entry>
         <entry><emphasis>LATIN2</emphasis>,
         <literal>MULE_INTERNAL</literal>,
         <literal>UTF8</literal>,
         <literal>WIN1250</literal>
         </entry>
        </row>
        <row> 
         <entry><literal>LATIN3</literal></entry>
         <entry><emphasis>LATIN3</emphasis>,
         <literal>MULE_INTERNAL</literal>,
         <literal>UTF8</literal>
         </entry>
        </row>
        <row> 
         <entry><literal>LATIN4</literal></entry>
         <entry><emphasis>LATIN4</emphasis>,
         <literal>MULE_INTERNAL</literal>,
         <literal>UTF8</literal>
         </entry>
        </row>
        <row> 
         <entry><literal>LATIN5</literal></entry>
         <entry><emphasis>LATIN5</emphasis>,
         <literal>UTF8</literal>
         </entry>
        </row>
        <row> 
         <entry><literal>LATIN6</literal></entry>
         <entry><emphasis>LATIN6</emphasis>,
         <literal>UTF8</literal>
         </entry>
        </row>
        <row> 
         <entry><literal>LATIN7</literal></entry>
         <entry><emphasis>LATIN7</emphasis>,
         <literal>UTF8</literal>
         </entry>
        </row>
        <row> 
         <entry><literal>LATIN8</literal></entry>
         <entry><emphasis>LATIN8</emphasis>,
         <literal>UTF8</literal>
         </entry>
        </row>
        <row> 
         <entry><literal>LATIN9</literal></entry>
         <entry><emphasis>LATIN9</emphasis>,
         <literal>UTF8</literal>
         </entry>
        </row>
        <row> 
         <entry><literal>LATIN10</literal></entry>
         <entry><emphasis>LATIN10</emphasis>,
         <literal>UTF8</literal>
         </entry>
        </row>
        <row>
         <entry><literal>MULE_INTERNAL</literal></entry>
         <entry><emphasis>MULE_INTERNAL</emphasis>,
          <literal>BIG5</literal>,
          <literal>EUC_CN</literal>,
          <literal>EUC_JP</literal>,
          <literal>EUC_KR</literal>,
          <literal>EUC_TW</literal>,
          <literal>ISO_8859_5</literal>,
          <literal>KOI8</literal>,
          <literal>LATIN1</literal> vers <literal>LATIN4</literal>,
          <literal>SJIS</literal>,
          <literal>WIN866</literal>,
          <literal>WIN1250</literal>,
          <literal>WIN1251</literal>
         </entry>
        </row>
        <row> 
         <entry><literal>SJIS</literal></entry>
         <entry><emphasis>non supporté comme codage serveur</emphasis>
         </entry>
        </row>
        <row>
         <entry><literal>SQL_ASCII</literal></entry>
         <entry><emphasis>tous (aucune conversion ne sera réalisée)</emphasis>
         </entry>
        </row>
        <row>
         <entry><literal>UHC</literal></entry>
         <entry><emphasis>non supporté comme codage serveur</emphasis>
         </entry>
        </row>
        <row>
         <entry><literal>UTF8</literal></entry>
         <entry><emphasis>tout codage supporté</emphasis>
         </entry>
        </row>
        <row>
         <entry><literal>WIN866</literal></entry>
         <entry><emphasis>WIN866</emphasis>,
          <literal>ISO_8859_5</literal>,
          <literal>KOI8</literal>,
          <literal>MULE_INTERNAL</literal>,
          <literal>UTF8</literal>,
          <literal>WIN1251</literal>
         </entry>
        </row>
        <row>
         <entry><literal>WIN874</literal></entry>
         <entry><emphasis>WIN874</emphasis>,
         <literal>UTF8</literal>
         </entry>
        </row>
        <row>
         <entry><literal>WIN1250</literal></entry>
         <entry><emphasis>WIN1250</emphasis>,
          <literal>LATIN2</literal>,
          <literal>MULE_INTERNAL</literal>,
          <literal>UTF8</literal>
         </entry>
        </row>
        <row>
         <entry><literal>WIN1251</literal></entry>
         <entry><emphasis>WIN1251</emphasis>,
          <literal>ISO_8859_5</literal>,
          <literal>KOI8</literal>,
          <literal>MULE_INTERNAL</literal>,
          <literal>UTF8</literal>,
          <literal>WIN866</literal>
         </entry>
        </row>
        <row>
         <entry><literal>WIN1252</literal></entry>
         <entry><emphasis>WIN1252</emphasis>,
          <literal>UTF8</literal>
         </entry>
        </row>
        <row>
         <entry><literal>WIN1256</literal></entry>
         <entry><emphasis>WIN1256</emphasis>,
         <literal>UTF8</literal>
         </entry>
        </row>
        <row>
         <entry><literal>WIN1258</literal></entry>
         <entry><emphasis>WIN1258</emphasis>,
         <literal>UTF8</literal>
         </entry>
        </row>
       </tbody>
      </tgroup>
     </table>

    <para>
     Pour activer la conversion automatique de jeux de caractères, vous devez
     dire à <productname>PostgreSQL</productname> quel jeu de caractères 
     (codage) vous voulez utiliser côté client. Il y a plusieurs façons de
     faire cela&nbsp;:

     <itemizedlist>
      <listitem>
       <para>
	En utilisant la commande <command>\encoding</command> dans
	<application>psql</application>.
	<command>\encoding</command> vous permet de changer de jeu de caractères
	client à la volée. Par exemple, pour changer le codage en
        <literal>SJIS</literal>, tapez&nbsp;:

<programlisting>\encoding SJIS</programlisting>
       </para>
      </listitem>

      <listitem>
       <para>
	En utilisant les fonctions <application>libpq</application>.
	<command>\encoding</command> appelle en fait
	<function>PQsetClientEncoding()</function> pour faire son travail.

<synopsis>int PQsetClientEncoding(PGconn *<replaceable>conn</replaceable>, const char *<replaceable>encoding</replaceable>);</synopsis>

	ou <replaceable>conn</replaceable> est une connexion au serveur,
	et <replaceable>encoding</replaceable> est le codage que vous
	voulez utiliser. Si la fonction fixe le codage, elle renvoie 0,
	sinon -1. Le codage actuel pour cette connexion peut être déterminé
        en utilisant&nbsp;:

<synopsis>int PQclientEncoding(const PGconn *<replaceable>conn</replaceable>);</synopsis>

	Notez que ceci renvoie l'ID du codage, pas une chaîne symbolique telle que
	<literal>EUC_JP</literal>. Pour convertir un ID du codage en NOM, vous
	pouvez utiliser&nbsp;:

<synopsis>char *pg_encoding_to_char(int <replaceable>encoding_id</replaceable>);</synopsis>
       </para>
      </listitem>

      <listitem>
       <para>
	En utilisant <command>SET client_encoding TO</command>.

	Fixer le codage client peut être fait avec cette commande SQL&nbsp;:

<programlisting>SET CLIENT_ENCODING TO '<replaceable>valeur</replaceable>';</programlisting>

	Vous pouvez aussi utiliser la syntaxe SQL plus standard <literal>SET
	NAMES</literal> pour ceci&nbsp;:

<programlisting>SET NAMES '<replaceable>valeur</replaceable>';</programlisting>

	Pour demander l'actuel codage client&nbsp;:

<programlisting>SHOW client_encoding;</programlisting>

	Pour revenir au codage par défaut&nbsp;:

<programlisting>RESET client_encoding;</programlisting>
       </para>
      </listitem>

      <listitem>
       <para>
	En utilisant <envar>PGCLIENTENCODING</envar>.

	Si la variable d'environnement <envar>PGCLIENTENCODING</envar> est définie
	dans l'environnement client, ce codage client est automatiquement 
	sélectionné lorsqu'une connexion au serveur est établie (ceci peut être
	surchargé avec n'importe quelle autre des méthodes ci-dessus).
       </para>
      </listitem>

      <listitem>
      <para>
      En utilisant la variable de configuration <xref
      linkend="guc-client-encoding"/>.
      Si la variable <varname>client_encoding</varname> est définie,
      ce codage client est automatiquement sélectionné lorsqu'une 
      connexion au serveur est établie (ceci peut être surchargé avec
      n'importe quelle autre des méthodes ci-dessus).
       </para>
      </listitem>

     </itemizedlist>
    </para>

    <para>
     Si la conversion d'un caractère particulier n'est pas possible &mdash;
     supposons que vous avez choisi <literal>EUC_JP</literal> pour le serveur 
     et <literal>LATIN1</literal> pour le client, alors certains caractères
     japonais n'ont pas de représentation en <literal>LATIN1</literal>
     &mdash; une erreur est alors rapportée.
    </para>

    <para>
     Si l'ensemble de caractères du client est défini en tant que
     <literal>SQL_ASCII</literal>, la conversion du codage est désactivée quelque
     soit l'ensemble de caractères du serveur. Comme pour le serveur, utiliser
     <literal>SQL_ASCII</literal> est déconseillé sauf si vous ne travaillez qu'avec
     des données ASCII.
    </para>
   </sect2>

   <sect2>
    <title>Plus de lecture</title>

    <para>
     Ceux-ci sont de bonnes sources pour commencer à maîtriser les différents 
     jeux de caractères.

     <variablelist>
      <varlistentry>
       <term><ulink 
       url="http://www.i18ngurus.com/docs/984813247.html"></ulink></term>

       <listitem>
        <para>
         Une collection complète de documents sur les ensembles de caractères,
         les codages et les pages code.
        </para>
       </listitem>
      </varlistentry>

      <varlistentry>
       <term><ulink 
      url="ftp://ftp.ora.com/pub/examples/nutshell/ujip/doc/cjk.inf"></ulink></term>

       <listitem>
        <para>
         Des explications détaillées de <literal>EUC_JP</literal>,
         <literal>EUC_CN</literal>, <literal>EUC_KR</literal>,
         <literal>EUC_TW</literal> apparaissent dans la section 3.2.
        </para>
       </listitem>
      </varlistentry>

      <varlistentry>
       <term><ulink url="http://www.unicode.org/"></ulink></term>

       <listitem>
        <para>
         Le site web du Unicode Consortium
        </para>
       </listitem>
      </varlistentry>

      <varlistentry>
       <term>RFC 2044</term>

       <listitem>
        <para>
	 <acronym>UTF</acronym>-8 est défini ici.
        </para>
       </listitem>
      </varlistentry>
     </variablelist>
    </para>
   </sect2>

  </sect1>

</chapter>

<!-- Keep this comment at the end of the file
Local variables:
mode:sgml
sgml-omittag:nil
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
sgml-parent-document:nil
sgml-default-dtd-file:"./reference.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:("/usr/lib/sgml/catalog")
sgml-local-ecat-files:nil
End:
-->
