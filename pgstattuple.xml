
<sect1 id="pgstattuple">
 <title>pgstattuple</title>
 
 <indexterm zone="pgstattuple">
  <primary>pgstattuple</primary>
 </indexterm>

 <para>
  Le module <literal>pgstattuple</literal> fournit différentes fonctions
  pour obtenir les statistiques sur les lignes.
 </para>

 <sect2>
  <title>Fonctions</title>

  <itemizedlist>
   <listitem>
    <para>
     <literal>pgstattuple()</literal> renvoie la longueur de la relation, le
     pourcentage de lignes mortes dans une relation et plein d'autres
     informations. Ceci peut aider les utilisateurs à déterminer le moment
     où un VACUUM est nécessaire. Voici un exemple&nbsp;:
    </para>
    <programlisting>
test=> \x
Expanded display is on.
test=> SELECT * FROM pgstattuple('pg_catalog.pg_proc');
-[ RECORD 1 ]------+-------
table_len          | 458752
tuple_count        | 1470
tuple_len          | 438896
tuple_percent      | 95.67
dead_tuple_count   | 11
dead_tuple_len     | 3157
dead_tuple_percent | 0.69
free_space         | 8932
free_percent       | 1.95
    </programlisting>
    <para>
     Voici une explication de chaque colonne&nbsp;:
    </para>
    
    <table>
     <title>Description des colonnes de <literal>pgstattuple()</literal></title>
     <tgroup cols="2">
      <thead>
       <row>
        <entry>Colonne</entry>
        <entry>Description</entry>
       </row>
      </thead>
      <tbody>
       <row>
        <entry>table_len</entry>
        <entry>longueur physique de la relation en octets</entry>
       </row>
       <row>
        <entry>tuple_count</entry>
        <entry>nombre de lignes vivantes</entry>
       </row>
       <row>
        <entry>tuple_len</entry>
        <entry>longueur des lignes vivantes en octets</entry>
       </row>
       <row>
        <entry>tuple_percent</entry>
        <entry>pourcentage de lignes vivantes</entry>
       </row>
       <row>
        <entry>dead_tuple_len</entry>
        <entry>longueur des lignes mortes en octets</entry>
       </row>
       <row>
        <entry>dead_tuple_percent</entry>
        <entry>pourcentage de lignes mortes</entry>
       </row>
       <row>
        <entry>free_space</entry>
        <entry>espace libre en octets</entry>
       </row>
       <row>
        <entry>free_percent</entry>
        <entry>pourcentage d'espace libre</entry>
       </row>
      </tbody>
     </tgroup>
    </table>
    <para>
     <note>
      <para>
       <literal>pgstattuple</literal> acquiert un verrou en lecture sur la
       relation. Donc cela pourrait affecter les mises à jour.
      </para>
     </note>
     <note>
      <para>
       <literal>pgstattuple</literal> estime qu'une ligne est morte si
       HeapTupleSatisfiesNow() renvoie false.
      </para>
     </note>
    </para>
   </listitem>


   <listitem>
    <para>
     <literal>pg_relpages()</literal> renvoie le nombre de pages dans la
     relation.
    </para>
   </listitem>

   <listitem>
    <para>
     <literal>pgstatindex()</literal> renvoie un tableau affichant des
     informations sur un index&nbsp;:
    </para>
    <programlisting>
test=> \x
Expanded display is on.
test=> SELECT * FROM pgstatindex('pg_cast_oid_index');
-[ RECORD 1 ]------+------
version            | 2
tree_level         | 0
index_size         | 8192
root_block_no      | 1
internal_pages     | 0
leaf_pages         | 1
empty_pages        | 0
deleted_pages      | 0
avg_leaf_density   | 50.27
leaf_fragmentation | 0
    </programlisting>
   </listitem>
  </itemizedlist>
 </sect2>

 <sect2>
  <title>Usage</title>
  <para>
   <literal>pgstattuple</literal> est appelée comme une fonction SRF et est
   définie ainsi&nbsp;:
  </para>
  <programlisting>
    CREATE OR REPLACE FUNCTION pgstattuple(text) RETURNS pgstattuple_type
     AS 'MODULE_PATHNAME', 'pgstattuple'
     LANGUAGE C STRICT;

    CREATE OR REPLACE FUNCTION pgstattuple(oid) RETURNS pgstattuple_type
     AS 'MODULE_PATHNAME', 'pgstattuplebyid'
     LANGUAGE C STRICT;
  </programlisting>
  <para>
   L'argument est le nom de la relation (qui peut être qualifié) ou l'OID
   de la relation. Notez que pgstattuple ne renvoie qu'une ligne.
  </para>
 </sect2>

</sect1>
