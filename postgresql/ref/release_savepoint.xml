<?xml version="1.0" encoding="UTF-8"?>
<refentry id="sql-release-savepoint">
 <indexterm zone="sql-release-savepoint">
  <primary>RELEASE SAVEPOINT</primary>
 </indexterm>

 <indexterm zone="sql-release-savepoint">
  <primary>point de sauvegarde</primary>
  <secondary>destruction</secondary>
 </indexterm>

 <refmeta>
  <refentrytitle>RELEASE SAVEPOINT</refentrytitle>
  <manvolnum>7</manvolnum>
  <refmiscinfo>SQL - Instructions du langage</refmiscinfo>
 </refmeta>

 <refnamediv>
  <refname>RELEASE SAVEPOINT</refname>
  <refpurpose>relâche un point de sauvegarde précédemment défini</refpurpose>
 </refnamediv>

 <refsynopsisdiv>
  <synopsis>RELEASE [ SAVEPOINT ] <replaceable>nom_pointsauvegarde</replaceable>
  </synopsis>
 </refsynopsisdiv>

 <refsect1>
  <title>Description</title>

  <para>
   <command>RELEASE SAVEPOINT</command> releases the named savepoint and
   all active savepoints that were created after the named savepoint,
   and frees their resources.  All changes made since the creation of
   the savepoint that didn't already get rolled back are merged into
   the transaction or savepoint that was active when the named savepoint
   was created.  Changes made after <command>RELEASE SAVEPOINT</command>
   will also be part of this active transaction or savepoint.
  </para>

  <para>
   <command>RELEASE SAVEPOINT</command> détruit aussi tous les points de
   sauvegarde créés ultérieurement au point de sauvegarde indiqué.
  </para>
 </refsect1>

 <refsect1>
  <title>Paramètres</title>

  <variablelist>
   <varlistentry>
    <term><replaceable>nom_pointsauvegarde</replaceable></term>
    <listitem>
     <para>
      Le nom du point de sauvegarde à relâcher.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </refsect1>

 <refsect1>
  <title>Notes</title>

  <para>
   Spécifier un nom de point de sauvegarde qui n'a pas été défini est une erreur.
  </para>

  <para>
   Il n'est pas possible de relâcher un point de sauvegarde lorsque la transaction
   est dans un état d'annulation;  to do that, use <xref linkend="sql-rollback-to"/>.
  </para>

  <para>
   Si plusieurs points de transaction ont le même nom, seul le plus récemment
   défini et non libéré est libéré. Des commandes répétées libéreront
   progressivement les anciens points de transaction.
  </para>

 </refsect1>

 <refsect1>
  <title>Exemples</title>

  <para>
   Pour établir puis relâcher un point de sauvegarde&nbsp;:
   <programlisting>BEGIN;
    INSERT INTO table1 VALUES (3);
    SAVEPOINT mon_pointsauvegarde;
    INSERT INTO table1 VALUES (4);
    RELEASE SAVEPOINT mon_pointsauvegarde;
COMMIT;
   </programlisting>
   La transaction ci-dessus insère à la fois 3 et 4.
  </para>

  <para>
   A more complex example with multiple nested subtransactions:
<programlisting>
BEGIN;
    INSERT INTO table1 VALUES (1);
    SAVEPOINT sp1;
    INSERT INTO table1 VALUES (2);
    SAVEPOINT sp2;
    INSERT INTO table1 VALUES (3);
    RELEASE SAVEPOINT sp2;
    INSERT INTO table1 VALUES (4))); -- generates an error
</programlisting>
   In this example, the application requests the release of the savepoint
   <literal>sp2</literal>, which inserted 3.  This changes the insert's
   transaction context to <literal>sp1</literal>.  When the statement
   attempting to insert value 4 generates an error, the insertion of 2 and
   4 are lost because they are in the same, now-rolled back savepoint,
   and value 3 is in the same transaction context.  The application can
   now only choose one of these two commands, since all other commands
   will be ignored:
<programlisting>
   ROLLBACK;
   ROLLBACK TO SAVEPOINT sp1;
</programlisting>
   Choosing <command>ROLLBACK</command> will abort everything, including
   value 1, whereas <command>ROLLBACK TO SAVEPOINT sp1</command> will retain
   value 1 and allow the transaction to continue.
  </para>

 </refsect1>

 <refsect1>
  <title>Compatibilité</title>

  <para>
   Cette commande est conforme au standard <acronym>SQL</acronym>. Le standard
   impose le mot clé <literal>SAVEPOINT</literal> mais
   <productname>PostgreSQL</productname> autorise son omission.
  </para>
 </refsect1>

 <refsect1>
  <title>Voir aussi</title>

  <simplelist type="inline">
   <member><xref linkend="sql-begin"/></member>
   <member><xref linkend="sql-commit"/></member>
   <member><xref linkend="sql-rollback"/></member>
   <member><xref linkend="sql-rollback-to"/></member>
   <member><xref linkend="sql-savepoint"/></member>
  </simplelist>
 </refsect1>
</refentry>
