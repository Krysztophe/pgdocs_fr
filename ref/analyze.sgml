<!--
$Header: /var/lib/cvs/pgsql-fr/sgml/ref/analyze.sgml,v 1.9 2005/03/14 06:03:51 guillaume Exp $
PostgreSQL documentation
-->

<refentry id="SQL-ANALYZE">
 <refmeta>
  <refentrytitle id="sql-analyze-title">ANALYZE</refentrytitle>
  <refmiscinfo>SQL - Instructions du langage</refmiscinfo>
 </refmeta>

 <refnamediv>
  <refname>ANALYZE</refname>
  <refpurpose>récupère des statistiques sur une base de données</refpurpose>
 </refnamediv>

 <indexterm zone="sql-analyze">
  <primary>ANALYZE</primary>
 </indexterm>

 <refsynopsisdiv>
<synopsis>
ANALYZE [ VERBOSE ] [ <replaceable class="PARAMETER">table</replaceable> [ (<replaceable class="PARAMETER">colonne</replaceable> [, ...] ) ] ]
</synopsis>
 </refsynopsisdiv>

 <refsect1>
  <title>Description</title>

  <para>
   <command>ANALYZE</command> collecte des statistiques sur le contenu des 
   tables de la base de données et stocke les résultats dans la table système
   <literal>pg_statistic</literal>. L'optimiseur de requêtes les utilise pour
   déterminer les plans d'exécution les plus efficaces.
  </para>

  <para>
   Sans paramètre, <command>ANALYZE</command> examine chaque table dans la base
   de données en cours. Avec un paramètre, <command>ANALYZE</command> examine
   seulement cette table. Il est possible de donner une liste des noms de
   colonnes, auquel cas seules les statistiques concernant ces colonnes sont
   collectées.
  </para>
 </refsect1>

 <refsect1>
  <title>Paramètres</title>

  <variablelist>
   <varlistentry>
    <term><literal>VERBOSE</literal></term>
    <listitem>
     <para>
      Active l'affichage de messages de progression.
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><replaceable class="PARAMETER">table</replaceable></term>
    <listitem>
     <para>
      Le nom (éventuellement précédé du nom du schéma) d'une table spécifique à
      analyser. Par défaut, il s'agit de toutes les tables dans la base
      de données en cours.
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><replaceable class="PARAMETER">column</replaceable></term>
    <listitem>
     <para>
      Le nom d'une colonne spécifique à analyser. Par défaut, toutes
      les colonnes.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </refsect1>

 <refsect1>
  <title>Sorties</title>

   <para>
    Quand <literal>VERBOSE</> est spécifié, <command>ANALYZE</> émet des
    messages de progression pour indiquer quelle table est en cours de
    traitement. Sont aussi affichées différentes statistiques sur les tables.
   </para>
 </refsect1>

 <refsect1>
  <title>Notes</title>

  <para>
   Lancer périodiquement <command>ANALYZE</command> est une bonne idée, tout
   comme le lancer après de grosses modifications sur le contenu d'une table. 
   Des statistiques à jour aideront l'optimiseur à choisir le plan de
   requête le plus approprié et amélioreront du coup la rapidité du traitement
   des requêtes. Une stratégie habituelle est de lancer <xref
   linkend="sql-vacuum" endterm="sql-vacuum-title"> et
   <command>ANALYZE</command> une fois par jour au moment où le serveur est le
   moins sollicité.
  </para>

  <para>
   Contrairement à <command>VACUUM FULL</command>, <command>ANALYZE</command>
   requiert seulement un verrou en lecture sur la table cible, donc il peut 
   être lancé en parallèle à d'autres activités sur la table.
  </para>

  <para>
   Les statistiques récupérées par <command>ANALYZE</command> incluent
   habituellement une liste des quelques valeurs les plus communes dans chaque
   colonne et un histogramme affichant une distribution approximative des
   données dans chaque colonne. L'un ou l'autre pourraient être omis
   si <command>ANALYZE</command> les trouve inintéressants (par exemple, dans
   une colonne à clé unique, il n'y a pas de valeurs communes) ou si le type de
   données de la colonne ne supporte pas les opérateurs appropriés. Il y a plus
   d'informations sur les statistiques dans le <xref linkend="maintenance">.
  </para>

  <para>
   Pour les grosses tables, <command>ANALYZE</command> prend aléatoirement
   plusieurs lignes de la table, au hasard, plutôt que d'examiner chaque ligne.
   Ceci permet à des tables très larges d'être examinées dans une petite période
   de temps. Notez, néanmoins, que les statistiques sont seulement
   approximatives et qu'elles changeront légèrement à chaque fois
   qu'<command>ANALYZE</command> est lancé, même si le contenu réel de la table
   n'a pas changé. Ceci pourrait résulter en de petites modifications dans les
   coûts estimés de l'optimiseur affichés par <command>EXPLAIN</command>. Dans
   de rare situations, ce non-déterminisme causera le choix d'un plan de requête
   différent par l'optimiseur entre deux lancements
   d'<command>ANALYZE</command>. Pour éviter ceci, augmentez le nombre de
   statistiques récupérées par <command>ANALYZE</command>, comme décrit
   ci-dessous.
  </para>

  <para>
   L'étendue des analyses est contrôlable globalement en ajustant la variable
   de configuration <xref linkend="guc-default-statistics-target"> ou colonne
   par colonne en initialisant la cible des statistiques par colonne avec
   <command>ALTER TABLE ... ALTER COLUMN ... SET STATISTICS</command> (voir
   <xref linkend="sql-altertable" endterm="sql-altertable-title">). Cette valeur
   cible initialise le nombre maximum d'entrées dans la liste des valeurs les
   plus communes et le nombre maximum de points dans l'histogramme. La valeur
   cible par défaut est de 10 mais ceci peut être ajusté en prenant compte la
   précision des estimations de l'optimiseur, le temps pris par
   <command>ANALYZE</command> et l'espace total occupé dans
   <literal>pg_statistic</literal>. En particulier, initialiser la cible des
   statistiques à zéro désactive la récupération de statistiques pour cette
   colonne. Il pourrait être utile de le faire pour les colonnes qui ne sont
   jamais utilisées dans les clauses <literal>WHERE</>, <literal>GROUP BY</> ou
   <literal>ORDER BY</> de requêtes car l'optimiseur n'utilisera pas les
   statistiques pour ces colonnes.
  </para>

  <para>
   La plus grande cible de statistiques de toutes les colonnes en cours d'analyse
   détermine le nombre de lignes testées pour préparer les
   statistiques de la table. Augmenter cette cible cause une augmentation
   proportionnelle du temps et de l'espace nécessaires à 
   exécuter <command>ANALYZE</command>.
  </para>
 </refsect1>

 <refsect1>
  <title>Compatibilité</title>

  <para>
   Il n'existe pas d'instruction <command>ANALYZE</command> dans le standard
   SQL.
  </para>
 </refsect1>
</refentry>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:nil
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
sgml-parent-document:nil
sgml-default-dtd-file:"../reference.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:"/usr/lib/sgml/catalog"
sgml-local-ecat-files:nil
End:
-->
