<?xml version="1.0" encoding="ISO-8859-1"?>
<!--
$Header: /var/lib/cvs/pgsql-fr/sgml/ref/create_sequence.sgml,v 1.9 2005/07/10 17:28:01 guillaume Exp $
PostgreSQL documentation
-->
<!-- SAS 20060412 -->

<refentry id="sql-createsequence">
 <refmeta>
  <refentrytitle id="sql-createsequence-title">CREATE SEQUENCE</refentrytitle>
  <refmiscinfo>SQL - Instructions du langage</refmiscinfo>
 </refmeta>

 <refnamediv>
  <refname>CREATE SEQUENCE</refname>
  <refpurpose>définir un nouveau générateur de séquence</refpurpose>
 </refnamediv> 

 <refsynopsisdiv>
<synopsis>CREATE [ TEMPORARY | TEMP ] SEQUENCE <replaceable class="parameter">nom</replaceable> [ INCREMENT [ BY ] <replaceable class="parameter">incrément</replaceable> ]
    [ MINVALUE <replaceable class="parameter">valeurmin</replaceable> | NO MINVALUE ]
    [ MAXVALUE <replaceable class="parameter">valeurmax</replaceable> | NO MAXVALUE ]
    [ START [ WITH ] <replaceable class="parameter">début</replaceable> ]
    [ CACHE <replaceable class="parameter">cache</replaceable> ]
    [ [ NO ] CYCLE ]
</synopsis>
 </refsynopsisdiv>

 <refsect1>
  <title>Description</title>
  <indexterm zone="sql-createsequence">
   <primary>CREATE SEQUENCE</primary>
  </indexterm>

  <para>
   <command>CREATE SEQUENCE</command> crée un nouveau générateur de
   séquence de nombres. Cela implique la création et l'initialisation d'une nouvelle table
   à une seule ligne nommée <replaceable
   class="parameter">nom</replaceable>. Le générateur appartient à
   l'utilisateur qui exécute la commande.
  </para>

<!-- ICI -->
  <para>
   Si un nom de schéma est donné, alors la séquence est créée dans le schéma
   spécifié. Sinon, elle est créée dans le schéma courant. Des séquences
   temporaires existent dans un schéma spécial, donc un nom de schéma pourrait
   ne pas être donné lors de la création d'une séquence temporaire. Le nom de
   séquence doit être distinct du nom de tout autre séquence, table,
   index ou vue dans le même schéma.
  </para>

  <para>
   Après la création d'une séquence, vous utilisez les fonctions
   <function>nextval</function>, <function>currval</function> et
   <function>setval</function> pour opérer sur la séquence. Ces fonctions sont
   documentées dans <xref linkend="functions-sequence"/>.
  </para>

  <para>
   Bien que vous ne pouvez pas mettre à jour directement une séquence, vous
   pouvez utiliser une requête comme

<programlisting>SELECT * FROM <replaceable>nom</replaceable>;
</programlisting>

   pour examiner les paramètres et l'état courant d'une séquence. En
   particulier, le champ <literal>last_value</literal> de la séquence affiche la
   dernière valeur allouée par une session. (Bien sûr, cette valeur pourrait
   être obsolète au moment où elle est appelée si d'autres sessions lancent des
   appels de <function>nextval</function>.)
  </para>
 </refsect1>

 <refsect1>
  <title>Paramètres</title>

  <variablelist>
   <varlistentry>
    <term><literal>TEMPORARY</literal> ou <literal>TEMP</literal></term>
    <listitem>
     <para>
      Si spécifiée, l'objet de séquence est créé seulement pour cette session
      et est automatiquement supprimé lors de la sortie de la session. Les
      séquences existantes permanentes avec le même nom ne sont pas visibles
      (dans cette session) alors que la séquence temporaire existe, sauf si
      elles sont référencées avec les noms qualifiés du schéma.
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><replaceable class="parameter">nom</replaceable></term>
    <listitem>
     <para>
      Le nom (pouvant être qualifié avec le nom du schéma) de la séquence à
      créer.
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><replaceable class="parameter">incrément</replaceable></term>
    <listitem>
     <para>
      La clause optionnelle <literal>INCREMENT BY <replaceable
      class="parameter">incrément</replaceable></literal> spécifie la
      valeur ajoutée à la valeur de la séquence courante pour créer une
      nouvelle valeur. Une valeur positive créera une séquence ascendante, une
      négative en créera une descendante. La valeur par défaut est 1.
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><replaceable class="parameter">valeurmin</replaceable></term>
    <term><literal>NO MINVALUE</literal></term>
    <listitem>
     <para>
      La clause optionnelle <literal>MINVALUE <replaceable
      class="parameter">valeurmin</replaceable></literal> détermine la valeur
      minimale qu'une séquence peut générer. Si cette clause n'est pas fournie
      ou si <option>NO MINVALUE</option> est spécifié, alors les valeurs par
      défaut seront utilisées. Les valeurs par défaut sont 1 et
      -2<superscript>63</superscript>-1 pour les séquences respectivement ascendantes et
      descendantes.
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><replaceable class="parameter">valeurmax</replaceable></term>
    <term><literal>NO MAXVALUE</literal></term>
    <listitem>
     <para>
      La clause optionnelle <literal>MAXVALUE <replaceable
      class="parameter">valeurmax</replaceable></literal> détermine la valeur
      maximale pour la séquence. Si cette clause n'est pas fournie ou si
      <option>NO MAXVALUE</option> est specifié, alors les valeurs par défaut
      seront utilisées. Les valeurs par défaut sont 2<superscript>63</superscript>-1 et -1
      pour les séquences respectivement ascendantes et descendantes.
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><replaceable class="parameter">début</replaceable></term>
    <listitem>
     <para>
      La clause optionnelle <literal>START WITH <replaceable
      class="parameter">début</replaceable> </literal> autorise la séquence à
      commencer quelque part. La valeur de début par défaut est <replaceable
      class="parameter">valeurmin</replaceable> pour les séquences ascendantes 
      et <replaceable class="parameter">valeurmax</replaceable> pour les
      séquences descendantes.
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><replaceable class="parameter">cache</replaceable></term>
    <listitem>
     <para>
      La clause optionnelle <literal>CACHE <replaceable
      class="parameter">cache</replaceable></literal> spécifie comment les
      numéros de séquence doivent être préalloués et stockés en mémoire pour un
      accès plus rapide. La valeur minimale est 1 (seule une valeur peut être
      générée à un moment, c'est-à-dire pas de cache), et c'est aussi la valeur
      par défaut.
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><literal>CYCLE</literal></term>
    <term><literal>NO CYCLE</literal></term>
    <listitem>
     <para>
      L'option <literal>CYCLE</literal> autorise la séquence à recommencer au
      début lorsque <replaceable class="parameter">valeurmax</replaceable> ou
      <replaceable class="parameter">valeurmin</replaceable> a été atteinte par
      une séquence respectivement ascendante ou descendante. Si la limite est
      atteinte, le prochain nombre généré sera respectivement <replaceable
      class="parameter">valeurmin</replaceable> ou <replaceable
      class="parameter">valeurmax</replaceable>.
     </para>

     <para>
      Si <literal>NO CYCLE</literal> est spécifié, tout appel à
      <function>nextval</function> après que la séquence est atteint la valeur
      minimale renverra une erreur. Si ni <literal>CYCLE</literal> ni
      <literal>NO CYCLE</literal> ne sont spécifiés, <literal>NO CYCLE</literal>
      est la valeur par défaut.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </refsect1>

 <refsect1>
  <title>Notes</title>

  <para>
   Utilisez <command>DROP SEQUENCE</command> pour supprimer une séquence.
  </para>

  <para>
   Les séquences sont basées sur l'arithmétique <type>bigint</type>, donc l'échelle
   ne peut pas excéder l'échelle d'un entier sur huit octets
   (-9223372036854775808 à 9223372036854775807). Sur certaines vieilles
   plateformes, il pourrait ne pas y avoir de support du compilateur pour les
   entiers sur huit octets, auquel cas les séquences utilisent l'arithmétique
   des entiers (type <type>integer</type>) habituels (allant de -2147483648 à
   +2147483647).
  </para>

  <para>
   Des résultats inattendus pourraient être obtenus si un
   paramétrage de <replaceable class="parameter">cache</replaceable> plus grand
   que un est utilisé pour un objet séquence qui sera utilisé en concurrence par
   plusieurs séquences. Chaque session allouera du cache et des valeurs de
   séquences successives lors d'un accès à l'objet séquence et augmentera la
   valeur de <literal>last_value</literal> en concordance. Ensuite, les utilisations
   prochaines de <replaceable class="parameter">cache</replaceable>-1 dans cette
   session renverront simplement les valeurs préallouées sans toucher à l'objet
   séquence. Donc, tout nombre alloué mais non utilisé dans une session sera
   perdu lorsque la session se termine, causant des <quote>trous</quote> dans
   la séquence.
  </para>

  <para>
   De plus, bien que de nombreuses sessions sont garanties pour allouer des
   valeurs de séquences distinctes, les valeurs pourraient être générées en
   dehors de la séquence lorsque toutes les sessions sont considérées. Par
   exemple, avec un paramétrage du <replaceable
   class="parameter">cache</replaceable> à 10, la session A pourrait réserver
   des valeurs 1..10 et renvoyer <function>nextval</function>=1, alors la
   session B pourrait réserver des valeurs 11..20 et renvoyer
   <function>nextval</function>=11 avant que la session A ait généré
   <literal>nextval</literal>=2. Du coup, avec un paramétrage de <replaceable
   class="parameter">cache</replaceable> de un, il est sain d'assumer que les
   valeurs <function>nextval</function> sont générées séquentiellement&nbsp;; avec un
   paramétrage <replaceable class="parameter">cache</replaceable> plus grand que
   un, vous devriez seulement assumer que les valeurs <function>nextval</function>
   sont tous distinctes, et non pas qu'elles soient générées purement
   séquentiellement. De plus, <literal>last_value</literal> reflètera la dernière
   valeur réservée par toute session, qu'il ne soit ou non pas encore renvoyé
   par <function>nextval</function>.
  </para>

  <para>
   Une autre considération est qu'un <function>setval</function> exécuté sur une telle
   séquence ne sera pas notifiée pour les autres sessions jusqu'à ce qu'ils
   aient utilisé des valeurs préallouées qu'ils ont caché.
  </para>
 </refsect1>

 <refsect1>
  <title>Exemples</title>

  <para>
   Créer une séquence ascendante appelée <literal>serie</literal>, commençant à
   101&nbsp;:
<programlisting>CREATE SEQUENCE serie START 101;
</programlisting>
  </para>

  <para>
   Sélectionner le prochain numéro à partir de cette séquence&nbsp;:
<programlisting>SELECT nextval('serie');
    
 nextval
---------
     114
</programlisting>
  </para>

  <para>
   Utiliser cette séquence dans une commande <command>INSERT</command>&nbsp;:
<programlisting>INSERT INTO distributors VALUES (nextval('serie'), 'nothing');
</programlisting>
  </para>

  <para>
   Mettre à jour la valeur de la séquence après un <command>COPY
   FROM</command>&nbsp;:
<programlisting>BEGIN;
COPY distributeurs FROM 'fichier_entrees';
SELECT setval('serie', max(id)) FROM distributeurs;
END;
</programlisting>
  </para>
 </refsect1>

 <refsect1>
  <title>Compatibilité</title>

  <para>
   <command>CREATE SEQUENCE</command> est conforme au standard
   <acronym>SQL</acronym> sauf en ce qui concerne les exceptions
   suivantes&nbsp;:
   <itemizedlist>
    <listitem><para>L'expression <literal>AS &lt;type_données&gt;</literal>
     n'est pas supportée.</para></listitem>
    <listitem><para>Obtenir la prochaine valeur est possible en
     utilisant la fonction <function>nextval()</function> au lieu de l'expression
     <command>NEXT VALUE FOR</command> du standard.</para></listitem>
   </itemizedlist>
  </para>
 </refsect1>
</refentry>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:nil
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
sgml-parent-document:nil
sgml-default-dtd-file:"../reference.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:"/usr/lib/sgml/catalog"
sgml-local-ecat-files:nil
End:
-->
