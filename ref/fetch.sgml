<!--
$Header: /var/lib/cvs/pgsql-fr/sgml/ref/fetch.sgml,v 1.9 2005/06/20 20:52:03 guillaume Exp $
PostgreSQL documentation
-->

<refentry id="SQL-FETCH">
 <refmeta>
  <refentrytitle id="SQL-FETCH-TITLE">FETCH</refentrytitle>
  <refmiscinfo>SQL - Instructions du langage</refmiscinfo>
 </refmeta>

 <refnamediv>
  <refname>FETCH</refname>
  <refpurpose>récupère des lignes d'une requête en utilisant un curseur</refpurpose>
 </refnamediv>

 <indexterm zone="sql-fetch">
  <primary>FETCH</primary>
 </indexterm>

 <indexterm zone="sql-fetch">
  <primary>curseur</primary>
  <secondary>FETCH</secondary>
 </indexterm>

 <refsynopsisdiv>
<synopsis>
FETCH [ <replaceable class="PARAMETER">direction</replaceable> { FROM | IN } ]
<replaceable class="PARAMETER">nomcurseur</replaceable>

où <replaceable class="PARAMETER">direction</replaceable> peut être vide ou
faire partie de :

    NEXT
    PRIOR
    FIRST
    LAST
    ABSOLUTE <replaceable class="PARAMETER">nombre</replaceable>
    RELATIVE <replaceable class="PARAMETER">nombre</replaceable>
    <replaceable class="PARAMETER">nombre</replaceable>
    ALL
    FORWARD
    FORWARD <replaceable class="PARAMETER">nombre</replaceable>
    FORWARD ALL
    BACKWARD
    BACKWARD <replaceable class="PARAMETER">nombre</replaceable>
    BACKWARD ALL
</synopsis>
 </refsynopsisdiv>

 <refsect1>
  <title>Description</title>

  <para>
   <command>FETCH</command> récupère des lignes en utilisant un curseur déjà
   ouvert.
  </para>

  <para>
   Un curseur a une position associée qui est utilisée par <command>FETCH</>.
   La position du curseur peut être avant la première ligne du résultat d'une
   requête, une ligne particulière du résultat ou après la dernière ligne du
   résultat. Une fois créé, un curseur est positionné sur la ligne la plus
   récemment récupérée. Si <command>FETCH</> arrive à la fin des lignes
   disponibles, alors le curseur est positionné après la dernière
   ligne ou avant la première ligne au cas où la récupération se fait en marche
   arrière. <command>FETCH ALL</> ou <command>FETCH BACKWARD ALL</> laisse toujours le
   curseur positionné après la dernière ligne ou avant la première ligne.
  </para>

  <para>
   Les formes <literal>NEXT</>, <literal>PRIOR</>, <literal>FIRST</>,
   <literal>LAST</>, <literal>ABSOLUTE</>, <literal>RELATIVE</> récupèrent une
   seule ligne après avoir déplacé le curseur de façon appropriée. Si cette ligne
   n'existe pas, un résultat vide est renvoyé et le curseur est positionné à
   avant la première ligne ou après la dernière ligne suivant le sens de
   la progression.
  </para>

  <para>
   Les formes utilisant <literal>FORWARD</> et <literal>BACKWARD</> récupèrent
   le nombre de lignes indiqué en se déplaçant en avant ou en arrière, laissant
   le curseur positionné sur la dernière ligne renvoyée (ou après/avant toutes
   les lignes si <replaceable class="PARAMETER">nombre</replaceable> dépasse le
   nombre de lignes disponibles).
  </para>

  <para>
   <literal>RELATIVE 0</>, <literal>FORWARD 0</> et
   <literal>BACKWARD 0</> demandent la récupération de la ligne actuelle sans
   déplacer le curseur, c'est-à-dire une nouvelle récupération de la ligne
   récemment récupérée. La commande réussit sauf si le curseur est positionné
   avant la première ligne ou après la dernière ligne ; auquel cas, aucune
   ligne n'est renvoyée.
  </para>
 </refsect1>

 <refsect1>
  <title>Paramètres</title>

  <variablelist>
   <varlistentry>
    <term><replaceable class="PARAMETER">direction</replaceable></term>
    <listitem>
     <para>
      <replaceable class="PARAMETER">direction</replaceable> définit la
      direction de la récupération et le nombre de lignes à récupérer. Elle
      peut prendre les valeurs suivantes :

      <variablelist>
       <varlistentry>
        <term><literal>NEXT</literal></term>
        <listitem>
         <para>
          Récupère la prochaine ligne. Ceci est la valeur par défaut si
	  <replaceable class="PARAMETER">direction</replaceable> est omis.
         </para>
        </listitem>
       </varlistentry>

       <varlistentry>
        <term><literal>PRIOR</literal></term>
        <listitem>
         <para>
          Récupère la ligne précédente.
         </para>
        </listitem>
       </varlistentry>

       <varlistentry>
        <term><literal>FIRST</literal></term>
        <listitem>
         <para>
          Récupère la première ligne de la requête (identique à
	  <literal>ABSOLUTE 1</literal>).
         </para>
        </listitem>
       </varlistentry>

       <varlistentry>
        <term><literal>LAST</literal></term>
        <listitem>
         <para>
          Récupère la dernière ligne de la requête (identique à
	  <literal>ABSOLUTE -1</literal>).
         </para>
        </listitem>
       </varlistentry>

       <varlistentry>
        <term><literal>ABSOLUTE <replaceable
	class="PARAMETER">nombre</replaceable></literal></term>
        <listitem>
         <para>
          Récupère la <replaceable
          class="PARAMETER">nombre</replaceable>-ième ligne de la requête ou la
	  <literal>abs(<replaceable
          class="PARAMETER">nombre</replaceable>)</literal>-ième ligne à partir
	  de la fin si <replaceable
          class="PARAMETER">nombre</replaceable> est négatif. La position avant
	  la première ligne ou après la dernière si <replaceable
          class="PARAMETER">nombre</replaceable> est en dehors des
	  bornes ; en particulier, <literal>ABSOLUTE 0</literal> se
	  positionne avant la première ligne.
         </para>
        </listitem>
       </varlistentry>

       <varlistentry>
        <term><literal>RELATIVE <replaceable
	class="PARAMETER">nombre</replaceable></literal></term>
        <listitem>
         <para>
          Récupère la <replaceable
          class="PARAMETER">nombre</replaceable>-ième ligne ou la
          <literal>abs(<replaceable
          class="PARAMETER">nombre</replaceable>)</literal>-ième ligne précédente
          si <replaceable class="PARAMETER">nombre</replaceable> est négatif.
          <literal>RELATIVE 0</literal> récupère de nouveau la ligne actuelle
	  si elle existe.
         </para>
        </listitem>
       </varlistentry>

       <varlistentry>
        <term><replaceable class="PARAMETER">nombre</replaceable></term>
        <listitem>
         <para>
          Récupère les <replaceable
          class="PARAMETER">nombre</replaceable> lignes suivantes (identique à
          <literal>FORWARD <replaceable
          class="PARAMETER">nombre</replaceable></literal>).
         </para>
        </listitem>
       </varlistentry>

       <varlistentry>
        <term><literal>ALL</literal></term>
        <listitem>
         <para>
          Récupère toutes les lignes restantes (identique à
	  <literal>FORWARD ALL</literal>).
         </para>
        </listitem>
       </varlistentry>

       <varlistentry>
        <term><literal>FORWARD</literal></term>
        <listitem>
         <para>
          Récupère la ligne suivante (identique à <literal>NEXT</literal>).
         </para>
        </listitem>
       </varlistentry>

       <varlistentry>
        <term><literal>FORWARD <replaceable
	class="PARAMETER">nombre</replaceable></literal></term>
        <listitem>
         <para>
          Récupère les <replaceable
          class="PARAMETER">nombre</replaceable> lignes suivantes.
          <literal>FORWARD 0</literal> récupère de nouveau la ligne actuelle.
         </para>
        </listitem>
       </varlistentry>

       <varlistentry>
        <term><literal>FORWARD ALL</literal></term>
        <listitem>
         <para>
          Récupère toutes les lignes restantes.
         </para>
        </listitem>
       </varlistentry>

       <varlistentry>
        <term><literal>BACKWARD</literal></term>
        <listitem>
         <para>
          Récupère la ligne précédente (identique à <literal>PRIOR</literal>).
         </para>
        </listitem>
       </varlistentry>

       <varlistentry>
        <term><literal>BACKWARD <replaceable
	class="PARAMETER">nombre</replaceable></literal></term>
        <listitem>
         <para>
          Récupère les <replaceable
          class="PARAMETER">nombre</replaceable> lignes précédentes (parcours
	  inverse). <literal>BACKWARD 0</literal> récupère de nouveau la ligne
	  actuelle.
         </para>
        </listitem>
       </varlistentry>

       <varlistentry>
        <term><literal>BACKWARD ALL</literal></term>
        <listitem>
         <para>
          Récupère toutes les lignes précédentes (parcours inverse).
         </para>
        </listitem>
       </varlistentry>
      </variablelist>
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><replaceable class="PARAMETER">nombre</replaceable></term>
    <listitem>
     <para>
      <replaceable class="PARAMETER">nombre</replaceable> est une constante de
      type entier pouvant être signée, déterminant l'emplacement ou le nombre
      de lignes à récupérer. Pour les cas <literal>FORWARD</> et
      <literal>BACKWARD</>, spécifier une valeur négative pour <replaceable
      class="PARAMETER">nombre</replaceable> est équivalent à modifier le sens
      de <literal>FORWARD</> et <literal>BACKWARD</>.
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><replaceable class="PARAMETER">nomcurseur</replaceable></term>
    <listitem>
     <para>
      Le nom d'un curseur ouvert.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </refsect1>

 <refsect1>
  <title>Sorties</title>

  <para>
   En cas de succès, une commande <command>FETCH</> renvoie une balise de
   commande de la forme
<screen>
FETCH <replaceable class="parameter">nombre</replaceable>
</screen>
   Le <replaceable class="parameter">nombre</replaceable> est le nombre de
   lignes récupérées (zéro étant possible). Notez que dans
   <application>psql</application>, la balise de commande n'est pas
   réellement affichée car <application>psql</application> affiche à la place
   les lignes récupérées.
  </para>
 </refsect1>

 <refsect1>
  <title>Notes</title>

  <para>
   Le curseur doit être déclaré avec l'option <literal>SCROLL</literal> si
   vous avez l'intention d'utiliser une variante de <command>FETCH</> autre que
   <command>FETCH NEXT</> ou <command>FETCH FORWARD</> avec un nombre positif.
   Pour les requêtes simples, <productname>PostgreSQL</productname> autorise
   les parcours inverses à partir de curseurs non déclarés avec
   <literal>SCROLL</literal>, mais ce comportement n'est pas sûr. Si le curseur
   est déclaré avec <literal>NO SCROLL</literal>, aucun parcours inverse n'est
   autorisé.
  </para>

  <para>
   Les récupérations <literal>ABSOLUTE</literal> ne sont pas plus rapides que
   de naviguer vers la ligne désirée avec un déplacement relatif : de toute
   façon, l'implémentation sous-jacente doit parcourir toutes les lignes
   intermédiaires. Les récupérations absolues négatives sont même pires :
   la requête doit être lue jusqu'à la fin pour trouver la dernière ligne relue
   en sens inverse. Néanmoins, remonter vers le début de la requête 
   (comme avec <literal>FETCH ABSOLUTE 0</literal>) est rapide.
  </para>

  <para>
   Mettre à jour des données via un curseur n'est pas supporté actuellement par
   <productname>PostgreSQL</productname>.
  </para>

  <para>
   <xref linkend="sql-declare" endterm="sql-declare-title"> est utilisé pour
   définir un curseur. Utilisez <xref linkend="sql-move"
   endterm="sql-move-title"> pour modifier la position du curseur sans récupérer
   les données.
  </para>
 </refsect1>

 <refsect1>
  <title>Exemples</title>

  <para>
   L'exemple suivant parcourt une table en utilisant un curseur.

<programlisting>
BEGIN WORK;

-- Initialise un curseur :
DECLARE liahona SCROLL CURSOR FOR SELECT * FROM films;

-- Récupère les 5 premières lignes du curseur liahona :
FETCH FORWARD 5 FROM liahona;

 code  |          titre          | did | date_prod  |   genre  |  longueur
-------+-------------------------+-----+------------+----------+-----------
 BL101 | The Third Man           | 101 | 1949-12-23 | Drama    | 01:44
 BL102 | The African Queen       | 101 | 1951-08-11 | Romantic | 01:43
 JL201 | Une Femme est une Femme | 102 | 1961-03-12 | Romantic | 01:25
 P_301 | Vertigo                 | 103 | 1958-11-14 | Action   | 02:08
 P_302 | Becket                  | 103 | 1964-02-03 | Drama    | 02:28

-- Récupère la ligne précédente :
FETCH PRIOR FROM liahona;

 code  |  titre  | did | date_prod  |  genre |  longueur
-------+---------+-----+------------+--------+-----------
 P_301 | Vertigo | 103 | 1958-11-14 | Action | 02:08

-- Ferme le curseur et termine la transaction:
CLOSE liahona;
COMMIT WORK;
</programlisting>
  </para>        
 </refsect1>

 <refsect1>
  <title>Compatibilité</title>

  <para>
   Le standard SQL définit <command>FETCH</command> comme étant à utiliser
   uniquement dans le SQL embarqué. La variante de <command>FETCH</command>
   décrite ici renvoie les données comme s'il s'agissait du
   résultat d'un <command>SELECT</command> plutôt que de le placer dans des variables
   hôtes. A part ce point, <command>FETCH</command> est totalement
   compatible avec le standard SQL.
  </para>

  <para>
   Les formes de <command>FETCH</command> impliquant <literal>FORWARD</literal> et
   <literal>BACKWARD</literal>, ainsi que les formes <literal>FETCH <replaceable
   class="PARAMETER">nombre</replaceable></literal> et <literal>FETCH
   ALL</literal>, dans lesquelles <literal>FORWARD</literal> est implicite, sont
   des extensions de <productname>PostgreSQL</productname>.
  </para>

  <para>
   Le standard SQL autorise seulement <literal>FROM</> précédant le nom du
   curseur ; La possibilité d'utiliser <literal>IN</> est une extension.
  </para>
 </refsect1>

 <refsect1>
  <title>Voir aussi</title>

  <simplelist type="inline">
   <member><xref linkend="sql-close" endterm="sql-close-title"></member>
   <member><xref linkend="sql-declare" endterm="sql-declare-title"></member>
   <member><xref linkend="sql-move" endterm="sql-move-title"></member>
  </simplelist>
 </refsect1>
</refentry>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:nil
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
sgml-parent-document:nil
sgml-default-dtd-file:"../reference.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:"/usr/lib/sgml/catalog"
sgml-local-ecat-files:nil
End:
-->
