<?xml version="1.0" encoding="ISO-8859-1"?>
<!--
$Header: /var/lib/cvs/pgsql-fr/sgml/ref/initdb.sgml,v 1.10 2005/09/15 07:03:27 guillaume Exp $
PostgreSQL documentation
-->
<!-- SAS 20071011 : PG83b1 -->

<refentry id="app-initdb">
 <refmeta>
  <refentrytitle id="app-initdb-title">initdb</refentrytitle>
  <manvolnum>1</manvolnum>
  <refmiscinfo>Application</refmiscinfo>
 </refmeta>

 <refnamediv>
  <refname>initdb</refname>
  <refpurpose>Créer un nouveau « cluster »</refpurpose>
 </refnamediv>

 <refsynopsisdiv>
  <cmdsynopsis>
   <command>initdb</command>
   <arg rep="repeat"><replaceable>option</replaceable></arg>
   <group choice="plain">
    <arg>--pgdata </arg>
    <arg>-D </arg>
    <replaceable>répertoire</replaceable>
   </group>
  </cmdsynopsis>
 </refsynopsisdiv>

 <refsect1 id="r1-app-initdb-1">
  <title>
   Description
  </title>
  <indexterm zone="app-initdb">
   <primary>initdb</primary>
  </indexterm>

  <para>
   <command>initdb</command> crée une nouvelle grappe de bases de données, ou
   « cluster », <productname>PostgreSQL</productname>. Un cluster est un
   ensemble de bases de données gérées par une même instance du serveur.
  </para>

  <para>
   Créer un cluster consiste à&nbsp;:
    <itemizedlist>
     <listitem>
      <para>
       créer les répertoires dans lesquels sont stockées les données de la
       base&nbsp;;
      </para>
     </listitem>
     <listitem>
      <para>
       créer les tables partagées du catalogue (tables partagées par tout le
       cluster)&nbsp;;
      </para>
     </listitem>
     <listitem>
      <para>
       créer les bases de données <literal>template1</literal> et <literal>postgres</literal>.
      </para>
     </listitem>
    </itemizedlist>
   Lors de la création ultérieure d'une base de données, tout ce qui se
   trouve dans la base <literal>template1</literal> est copié. (Ce qui implique
   que tout ce qui est installé dans <literal>template1</literal> est
   automatiquement copié dans chaque base de données créée par la suite.) La base de
   données <literal>postgres</literal> est une base de données par défaut
   à destination des utilisateurs, des outils et des applications tiers.
  </para>

  <para>
   <command>initdb</command> tente de créer le répertoire de données
   indiqué. Il se peut que la commande n'est pas les droits nécessaires si
   le répertoire parent du répertoire de données indiqué est possédé par root.
   Dans ce cas, pour réussir l'initialisation, il faut créer un répertoire de données
   vide en tant que root,
   puis utiliser <command>chown</command> pour en donner la possession
   au compte utilisateur de la base de données. 
   <command>su</command> peut alors être utilisé pour prendre l'identité de l'utilisateur
   de la base de données et exécuter <command>initdb</command>.
  </para>

  <para>
   <command>initdb</command> doit être exécuté par l'utilisateur
   propriétaire du processus serveur parce que le serveur doit avoir accès
   aux fichiers et répertoires créés par <command>initdb</command>. Comme le
   serveur ne peut pas être exécuté en tant que root, il est impératif de ne pas
   lancer <command>initdb</command> en tant que root. (En fait, <command>initdb</command>
   refuse de se lancer dans ces conditions.)
  </para>

  <para>
   <command>initdb</command> initialise la locale et l'encodage par défaut
   du cluster. L'ordre de tri
   (<literal>LC_COLLATE</literal>) et les classes de jeux de caractères
   (<literal>LC_CTYPE</literal>, c'est-à-dire majuscule (<foreignphrase>upper</foreignphrase>),
   minuscule (<foreignphrase>lower</foreignphrase>), chiffre (<foreignphrase>digit</foreignphrase>))
   sont fixées pour l'ensemble des bases de données et ne peuvent
   pas être modifiées. Les ordres de tri autres que <literal>C</literal> ou
   <literal>POSIX</literal> sont également moins performants. Pour ces
   raisons, il est important de choisir la bonne locale lors de l'exécution
   d'<command>initdb</command>. Les catégories de locale restantes peuvent
   être modifiées par la suite, serveur démarré. Toutes les valeurs
   de locales du serveur (<literal>lc_*</literal>) peuvent être affichées 
   à l'aide de l'instruction <command>SHOW ALL</command>.
   Plus de détails sont disponibles dans <xref linkend="locale"/>.
  </para>

  <para>
   L'encodage d'une base de données peut être configuré à sa création.
   <command>initdb</command> détermine l'encodage de la base de données
   <literal>template1</literal>, qui sert de modèle par défaut pour les autres bases de données.
   Cet encodage par défaut peut être modifié avec l'option <option>--encoding</option>.
   De plus amples détails sont présentés dans <xref linkend="multibyte"/>.
  </para>

 </refsect1>

 <refsect1>
  <title>Options</title>

   <para>
    <variablelist>
     <varlistentry>
      <term><option>-A <replaceable class="parameter">méthode_auth</replaceable></option></term>
      <term><option>--auth=<replaceable class="parameter">méthode_auth</replaceable></option></term>
      <listitem>
       <para>
        Précise la méthode d'authentification utilisée dans <filename>pg_hba.conf</filename> 
	pour les utilisateurs locaux. <literal>trust</literal> ne doit être utilisé
	que lorsque tous les utilisateurs locaux du système sont dignes de confiance.
	Pour faciliter l'installation, <literal>trust</literal> est la valeur par défaut.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-D <replaceable class="parameter">répertoire</replaceable></option></term>
      <term><option>--pgdata=<replaceable class="parameter">répertoire</replaceable></option></term>
      <listitem>
       <para>
        Indique le répertoire de stockage de la grappe de bases de données.
	C'est la seule information requise par <command>initdb</command>. Il est possible
	d'éviter de préciser cette option en configurant la variable d'environnement
	<envar>PGDATA</envar>. Cela permet, de plus, au serveur de bases de données
	(<command>postgres</command>) de trouver le répertoire par cette même variable.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-E <replaceable class="parameter">codage</replaceable></option></term>
      <term><option>--encoding=<replaceable class="parameter">codage</replaceable></option></term>
      <listitem>
       <para>
        Définit l'encodage de la base de données modèle
	(<foreignphrase>template</foreignphrase>). C'est également l'encodage par défaut
	des bases de données créées ultérieurement. Cette valeur peut toutefois être surchargée.
	La valeur par défaut est déduite de la locale. Dans le cas où cela n'est pas
	possible, <literal>SQL_ASCII</literal> est utilisé. Les jeux de caractères supportés
	par le serveur <productname>PostgreSQL</productname> sont décrits dans
	<xref linkend="multibyte-charset-supported"/>.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>--locale=<replaceable>locale</replaceable></option></term>
      <listitem>
       <para>
        Configure la locale par défaut pour le cluster. Si
	cette option n'est pas précisée, la locale est héritée de
	l'environnement d'exécution d'<command>initdb</command>. Le support des
	locales est décrit dans <xref linkend="locale"/>.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>--lc-collate=<replaceable>locale</replaceable></option></term>
      <term><option>--lc-ctype=<replaceable>locale</replaceable></option></term>
      <term><option>--lc-messages=<replaceable>locale</replaceable></option></term>
      <term><option>--lc-monetary=<replaceable>locale</replaceable></option></term>
      <term><option>--lc-numeric=<replaceable>locale</replaceable></option></term>
      <term><option>--lc-time=<replaceable>locale</replaceable></option></term>

      <listitem>
       <para>
        Même principe que <option>--locale</option>, mais seule la locale de la catégorie
	considérée est configurée.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-X <replaceable class="parameter">directory</replaceable></option></term>
      <term><option>--xlogdir=<replaceable class="parameter">directory</replaceable></option></term>
      <listitem>
       <para>
        Définit le répertoire de stockage des journaux de transaction.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-U <replaceable class="parameter">nomutilisateur</replaceable></option></term>
      <term><option>--username=<replaceable class="parameter">nomutilisateur</replaceable></option></term>
      <listitem>
       <para>
        Précise le nom de l'utilisateur défini comme superutilisateur de la
	base de données. Par défaut, c'est le nom de l'utilisateur qui lance
	<command>initdb</command>. Le nom du superutilisateur importe peu,
	mais <systemitem>postgres</systemitem> peut être conservé, 
	même si le nom de l'utilisateur système diffère.
       </para>
      </listitem>
     </varlistentry>
 
     <varlistentry>
      <term><option>-W</option></term>
      <term><option>--pwprompt</option></term>
      <listitem>
       <para>
        Force <command>initdb</command> à demander un mot de passe pour le
	superutilisateur de la base de données. Cela n'a pas d'importance lorsqu'aucune
	authentification par mot de passe n'est envisagée.
	Dans le cas contraire, l'authentification par mot de passe n'est pas utilisable
	tant qu'un mot de passe pour le superutilisateur n'est pas défini.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>--pwfile=<replaceable>nomfichier</replaceable></option></term>
      <listitem>
       <para>
        Incite <command>initdb</command> à lire le mot de passe du
	superutilisateur à partir d'un fichier. La première ligne du fichier est utilisée
	comme mot de passe.
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </para>

   <para>
    D'autres paramètres, moins utilisés, sont disponibles&nbsp;:

    <variablelist>
     <varlistentry>
      <term><option>-d</option></term>
      <term><option>--debug</option></term>
      <listitem>
       <para>
	Affiche les informations de débogage du processus amorce
	et quelques autres messages de moindre intérêt pour le grand public. Le processus
	amorce est le programme qu'<command>initdb</command> lance
	pour créer les tables catalogues. Cette option engendre une quantité
	considérable de messages ennuyeux.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-L <replaceable class="parameter">répertoire</replaceable></option></term>
      <listitem>
       <para>
        Indique à <command>initdb</command> où trouver les fichiers
	d'entrée nécessaires à l'initialisation du cluster. En temps normal, cela n'est
	pas nécessaire. Un message est affiché lorsque leur emplacement doit être indiqué
	de manière explicite.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-n</option></term>
      <term><option>--noclean</option></term>
      <listitem>
       <para>
	Par défaut, lorsqu'<command>initdb</command> rencontre une erreur
	qui l'empêche de finaliser la création du cluster, le programme
	supprime tous les fichiers créés avant l'erreur. Cette option désactive le
	nettoyage. Elle est utile pour le débogage.
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </para>

 </refsect1>

 <refsect1>
  <title>Environnement</title>

  <variablelist>
   <varlistentry>
    <term><envar>PGDATA</envar></term>

    <listitem>
     <para>
      Indique le répertoire de stockage de la grappe de bases de données&nbsp;;
      peut être surchargé avec l'option <option>-D</option>.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <para>
   Cet outil, comme la plupart des autres outils <productname>PostgreSQL</productname>,
   utilise aussi les variables d'environnement supportées par la bibliothèque
   <application>libpq</application> (voir <xref linkend="libpq-envars"/>).
  </para>

 </refsect1>

 <refsect1>
  <title>Voir aussi</title>

  <simplelist type="inline">
   <member><xref linkend="app-postgres"/></member>
  </simplelist>
 </refsect1>

</refentry>
