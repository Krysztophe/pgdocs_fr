<?xml version="1.0" encoding="ISO-8859-15"?>
<!-- Dernière modification
     le       $Date$
     par      $Author$
     révision $Revision$ -->

<refentry id="app-pgdump">
 <refmeta>
  <refentrytitle>pg_dump</refentrytitle>
  <manvolnum>1</manvolnum>
  <refmiscinfo>Application</refmiscinfo>
 </refmeta>

 <refnamediv>
  <refname>pg_dump</refname>

  <refpurpose>
   sauvegarder une base de données <productname>PostgreSQL</productname> dans un
   script ou tout autre fichier d'archive
  </refpurpose>
 </refnamediv>

 <refsynopsisdiv>
  <cmdsynopsis>
   <command>pg_dump</command>
   <arg rep="repeat"><replaceable>option</replaceable></arg>
   <arg><replaceable>nom_base</replaceable></arg>
  </cmdsynopsis>
 </refsynopsisdiv>


 <refsect1 id="pg-dump-description">
  <title>
   Description
  </title>
  <indexterm zone="app-pgdump">
   <primary>pg_dump</primary>
  </indexterm>


  <para>
   <application>pg_dump</application> est un outil de sauvegarde d'une base de
   données <productname>PostgreSQL</productname>. Les sauvegardes 
   réalisées sont cohérentes, même lors d'accès concurrents à la base de données.
   <application>pg_dump</application> ne bloque pas l'accès des autres
   utilisateurs (ni en lecture ni en écriture).
  </para>

  <para>
   Les extractions peuvent être réalisées sous la forme de scripts ou de fichiers d'archive.
   Les scripts sont au format texte et contiennent les commandes SQL
   nécessaires à la reconstruction de la base de données dans l'état où elle était au
   moment de la sauvegarde. La restauration s'effectue en chargeant ces scrits avec
   <xref linkend="app-psql"/>. Ces scripts permettent de reconstruire la base de
   données sur d'autres machines et d'autres architectures, et même, au prix de
   quelques modifications, sur d'autres bases de données SQL.
  </para>

  <para>
   La reconstruction de la base de données à partir d'autres formats de fichiers archive
   est obtenue avec <xref linkend="app-pgrestore"/>. 
   <application>pg_restore</application> permet, à partir de ces formats, de sélectionner
   les éléments à restaurer, voire de les réordonner avant restauration.
   Les fichiers d'archive sont conçus pour être portables au travers d'architectures différentes.
  </para>

  <para>
   Utilisé avec un des formats de fichier d'archive et combiné
   avec <application>pg_restore</application>,
   <application>pg_dump</application> fournit un mécanisme d'archivage
   et de transfert flexible. <application>pg_dump</application> peut être utilisé pour
   sauvegarder une base de données dans son intégralité&nbsp;;
   <application>pg_restore</application> peut alors être utilisé pour examiner
   l'archive et/ou sélectionner les parties de la base de données à
   restaurer. Le format de fichier de sortie le plus flexible est le format
   <quote>personnalisé</quote> (<foreignphrase>custom</foreignphrase> en anglais, <option>-Fc</option>).
   Compressé par défaut, il permet de sélectionner et réordonner les éléments archivés.
   Non compressé, le format <application>tar</application> (<option>-Ft</option>)
   ne permet pas de réordonner les données au
   chargement, mais est, somme toute, assez flexible. Qui plus est, il est utilisable
   par des outils Unix standard comme <command>tar</command>.
  </para>

  <para>
   Lors de l'exécution de <application>pg_dump</application>, il est utile de 
   surveiller les messages d'avertissement (affichés sur la sortie erreur standard), 
   en particulier en ce qui concerne les limitations indiquées ci-dessous.
  </para>

 </refsect1>

 <refsect1 id="pg-dump-options">
  <title>Options</title>

  <para>
   Les options suivantes de la ligne de commande contrôlent le contenu et le
   format de la sortie.

    <variablelist>
     <varlistentry>
      <term><replaceable class="parameter">nom_base</replaceable></term>
      <listitem>
       <para>
	Le nom de la base de données à sauvegarder. En l'absence de précision, 
	la variable d'environnement <envar>PGDATABASE</envar> est utilisée. 
        Si cette variable n'est pas positionnée, le nom de l'utilisateur de la connexion est utilisé.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-a</option></term>
      <term><option>--data-only</option></term>
      <listitem>
       <para>
	Seules les données sont sauvegardées, pas le schéma (définition des données).
       </para>

       <para>
        Cette option n'a d'intérêt que pour le format texte.
	Pour les formats archive, l'option peut être précisée lors de l'appel de <command>pg_restore</command>.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-b</option></term>
      <term><option>--blobs</option></term>
      <listitem>
       <para>
        Inclut les objets larges dans la sauvegarde. C'est le comportement par
        défaut, sauf si une des options suivantes est ajoutée&nbsp;:
        <option>--schema</option>, <option>--table</option> ou
        <option>--schema-only</option>. L'option <option>-b</option>
        n'est utile que pour ajouter les objets larges aux
        sauvegardes sélectives.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-c</option></term>
      <term><option>--clean</option></term>
      <listitem>
       <para>
        Les commandes de nettoyage (suppression) des objets de la base
        sont écrites avant les commandes de création.
       </para>

       <para>
        Cette option n'a d'intérêt que pour le format texte. Pour les
	formats archive, l'option est précisée à l'appel de
	<command>pg_restore</command>.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-C</option></term>
      <term><option>--create</option></term>
      <listitem>
       <para>
        La sortie débute par une commande de création de la base de données
	et de connexion à cette base. Peu importe, dans ce cas, la base de données
        à laquelle la connexion est faite avant la restauration.
       </para>

       <para>
        Cette option n'a d'intérêt que pour le format texte. Pour les
	formats archive, l'option est précisée à l'appel de
	<command>pg_restore</command>.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-D</option></term>
      <term><option>--column-inserts</option></term>
      <term><option>--attribute-inserts</option></term>
      <listitem>
       <para>
        Les données sont copiées à l'aide de commandes <command>INSERT</command>
        qui explicitent les noms de colonnes 
        (<literal>INSERT INTO <replaceable>table</replaceable>
        (<replaceable>colonne</replaceable>, ...) VALUES ...</literal>).
        La restauration en est considérablement ralentie. Cela s'avère
        essentiellement utile pour créer des sauvegardes rechargées dans des
        bases de données autres que <productname>PostgreSQL</productname>. 
        De plus, comme cette option produit une commande séparée pour chaque
        ligne, une erreur lors du chargement d'une ligne ne perd que
        cette ligne plutôt que le contenu entier de la table.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-f <replaceable class="parameter">file</replaceable></option></term>
      <term><option>--file=<replaceable class="parameter">file</replaceable></option></term>
      <listitem>
       <para>
	La sortie est redirigée vers le fichier indiqué. Sans précision, la sortie
    	standard est utilisée.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
	  <term><option>-E <replaceable class="parameter">codage</replaceable></option></term>
	  <term><option>--encoding=<replaceable class="parameter">codage</replaceable></option></term>
	  <listitem>
	   <para>
	    La sauvegarde est créée dans l'encodage indiqué. Par défaut, la sauvegarde utilise celui
	    de la base de données. Le même résultat peut être obtenu en positionnant 
	    la variable d'environnement <envar>PGCLIENTENCODING</envar> avec le codage désiré pour la
	    sauvegarde.
	   </para>
	  </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-F <replaceable class="parameter">format</replaceable></option></term>
      <term><option>--format=<replaceable class="parameter">format</replaceable></option></term>
      <listitem>
       <para>
        Le format de la sortie.
	    <replaceable>format</replaceable> correspond à un des éléments suivants&nbsp;:

       <variablelist>
        <varlistentry>
         <term><literal>p</literal></term>
         <listitem>
          <para>
           fichier de scripts <acronym>SQL</acronym> en texte simple
	   (défaut)&nbsp;;
          </para>
         </listitem>
        </varlistentry>

        <varlistentry>
         <term><literal>t</literal></term>
         <listitem>
          <para>
           archive <command>tar</command> utilisable par <application>pg_restore</application>.
           Ce format permet d'ordonner et/ou d'exclure des objets lors
           de la restauration de la base. 
           Il est également possible de restreindre les données rechargées lors
	   de la restauration&nbsp;;
          </para>
         </listitem>
        </varlistentry>

        <varlistentry>
         <term><literal>c</literal></term>
         <listitem>
          <para>
           archive personnalisée utilisable par <application>pg_restore</application>.
           C'est le format le plus flexible puisqu'il permet d'ordonner le chargement des
	   données et la définition des objets. Ce format est compressé par défaut.
          </para>
         </listitem>
        </varlistentry>

       </variablelist>
       </para>

      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-i</option></term>
      <term><option>--ignore-version</option></term>
      <listitem>
       <para>
        A deprecated option that is now ignored.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-n <replaceable class="parameter">schéma</replaceable></option></term>
      <term><option>--schema=<replaceable class="parameter">schéma</replaceable></option></term>
      <listitem>
       <para>
        Sauvegarde uniquement les schémas correspondant à <replaceable
        class="parameter">schema</replaceable>&nbsp;; la sélection se fait à
        la fois sur le schéma et sur les objets qu'il contient. Quand cette
        option n'est pas indiquée, tous les schémas non système de la base cible
        sont sauvegardés. Plusieurs schémas peuvent être indiqués en utilisant
        plusieurs fois l'option <option>-n</option>. De plus, le paramètre
        <replaceable class="parameter">schéma</replaceable> est interprété comme
        un modèle selon les règles utilisées par les commandes
        <literal>\d</literal> de <application>psql</application> (voir <xref
        linkend="app-psql-patterns" endterm="app-psql-patterns-title"/>). Du
        coup, plusieurs schémas peuvent être sélectionnés en utilisant des
        caractères joker dans le modèle. Lors de l'utilisation de ces caractères,
        il faut faire attention à placer le modèle entre guillemets, si
	nécessaire, pour empêcher le shell de remplacer les jokers.
       </para>

       <note>
        <para>
         Quand <option>-n</option> est indiqué, <application>pg_dump</application>
         ne sauvegarde aucun autre objet de la base que ceux dont les schémas
         sélectionnés dépendent. Du coup, il n'est pas garanti que la sauvegarde
         d'un schéma puisse être restaurée avec succès dans une base vide.
        </para>
       </note>

       <note>
        <para>
         Les objets qui ne font pas partie du schéma comme les objets larges ne
         sont pas sauvegardés quand <option>-n</option> est précisé. Ils
	 peuvent être rajouter avec l'option <option>--blobs</option>.
        </para>
       </note>

      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-N <replaceable class="parameter">schéma</replaceable></option></term>
      <term><option>--exclude-schema=<replaceable class="parameter">schéma</replaceable></option></term>
      <listitem>
       <para>
        Ne sauvegarde pas les schémas correspondant au modèle <replaceable
        class="parameter">schéma</replaceable>. Le modèle est interprété selon
        les même règles que <option>-n</option>. <option>-N</option> peut aussi
        être indiqué plus d'une fois pour exclure des schémas correspondant à
        des modèles différents.
       </para>

       <para>
        Quand les options <option>-n</option> et <option>-N</option> sont
        indiquées, seuls sont sauvegardés les schémas qui correspondent à au moins
        une option <option>-n</option> et à aucune option
        <option>-N</option>. Si <option>-N</option> apparaît sans
        <option>-n</option>, alors les schémas correspondant à <option>-N</option>
        sont exclus de ce qui est une sauvegarde normale.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-o</option></term>
      <term><option>--oids</option></term>
      <listitem>
       <para>
	Les identifiants d'objets (<acronym>OID</acronym>) sont sauvegardés comme
	données des tables. Cette option est utilisée dans le cas d'applications
	utilisant des références aux colonnes <acronym>OID</acronym> 
	(dans une contrainte de clé étrangère, par exemple). Elle ne devrait pas être
	utilisée dans les autres cas.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-O</option></term>
      <term><option>--no-owner</option></term>
      <listitem>
       <para>
        Les commandes d'initialisation des possessions des objets au regard de
	la base de données originale ne sont pas produites. Par défaut, 
	<application>pg_dump</application> engendre des instructions
	<command>ALTER OWNER</command> ou 
	<command>SET SESSION AUTHORIZATION</command> pour
	fixer ces possessions. 
	Ces instructions échouent lorsque le script n'est pas
	lancé par un superutilisateur (ou par l'utilisateur
	qui possède tous les objets de ce script). L'option <option>-O</option>
	est utilisée pour créer un script qui puisse être restauré par n'importe 
	quel utilisateur. En revanche, c'est cet utilisateur qui devient 
	propriétaire de tous les objets.
       </para>

       <para>
        Cette option n'a d'intérêt que pour le format texte.
	Pour les formats archive, l'option est précisée à l'appel de <command>pg_restore</command>.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-R</option></term>
      <term><option>--no-reconnect</option></term>
      <listitem>
       <para>
        Cette option, obsolète, est toujours acceptée pour des raisons
	de compatibilité ascendante.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-s</option></term>
      <term><option>--schema-only</option></term>
      <listitem>
       <para>
	Seule la définition des objets (le schéma) est sauvegardée, pas les
	données.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-S <replaceable 	class="parameter">nomutilisateur</replaceable></option></term>
      <term><option>--superuser=<replaceable 	class="parameter">nomutilisateur</replaceable></option></term>
      <listitem>
       <para>
        Le nom du superutilisateur à utiliser lors de la désactivation
	des déclencheurs. Cela n'a d'intérêt que si l'option
	<option>--disable-triggers</option> est précisée. (En règle générale, 
	il est préférable de ne pas utiliser cette option et de lancer le script
	produit en tant que superutilisateur.)
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-t <replaceable class="parameter">table</replaceable></option></term>
      <term><option>--table=<replaceable class="parameter">table</replaceable></option></term>
      <listitem>
       <para>
        Sauvegarde uniquement les tables (ou vues ou séquences) correspondant
        à <replaceable class="parameter">table</replaceable>. Plusieurs tables
        sont sélectionnables en utilisant plusieurs fois l'option
        <option>-t</option>. De plus, le paramètre
        <replaceable class="parameter">table</replaceable> est interprété comme
        un modèle suivant les règles utilisées par les commandes
        <literal>\d</literal> de <application>psql</application> (voir <xref
        linkend="app-psql-patterns" endterm="app-psql-patterns-title"/>). Du
        coup, plusieurs tables peuvent être sélectionnées en utilisant des
        caractères joker dans le modèle. Lors de l'utilisation de ces caractères,
        il faut faire attention à placer le modèle entre guillemets, si
	nécessaire, pour empêcher le shell de remplacer les jokers.
       </para>

       <para>
        Les options <option>-n</option> et <option>-N</option> n'ont aucun effet
        quand l'option <option>-t</option> est utilisée car les tables
        sélectionnées par <option>-t</option> sont sauvegardées quelle que soit
        la valeur des options relatives aux schémas. Les objets qui ne sont
        pas des tables ne sont pas sauvegardés.
       </para>

       <note>
        <para>
         Quand <option>-t</option> est indiqué, <application>pg_dump</application>
         ne sauvegarde aucun autre objet de la base dont la (ou les) table(s)
         sélectionnée(s) pourrai(en)t dépendre. Du coup, il n'est pas garanti que la sauvegarde
         spécifique d'une table puisse être restaurée avec succès dans une base vide.
        </para>
       </note>

       <note>
        <para>
         Le comportement de l'option <option>-t</option> n'est pas entièrement
         compatible avec les versions de <productname>PostgreSQL</productname>
         antérieures à la 8.2. Auparavant, écrire <literal>-t tab</literal>
         sauvegardait toutes les tables nommées <literal>tab</literal>, mais
         maintenant, seules sont sauvegardées celles qui sont visibles dans le
         chemin de recherche des objets. Pour retrouver l'ancien comportement,
	 il faut écrire <literal>-t '*.tab'</literal>. De plus, il faut
         écrire quelque chose comme <literal>-t sch.tab</literal> pour sélectionner
         une table dans un schéma particulier plutôt que l'ancienne syntaxe
         <literal>-n sch -t tab</literal>.
        </para>
       </note>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-T <replaceable class="parameter">table</replaceable></option></term>
      <term><option>--exclude-table=<replaceable class="parameter">table</replaceable></option></term>
      <listitem>
       <para>
        Ne sauvegarde pas les tables correspondant au modèle <replaceable
        class="parameter">table</replaceable>. Le modèle est interprété selon
        les même règles que <option>-t</option>. <option>-T</option> peut aussi
        être indiqué plusieurs pour exclure des tables correspondant à
        des modèles différents.
       </para>

       <para>
        Quand les options <option>-t</option> et <option>-T</option> sont
        indiquées, seules sont sauvegardées les tables qui correspondent à au moins
        une option <option>-t</option> et à aucune option
        <option>-T</option>. Si <option>-T</option> apparaît sans
        <option>-t</option>, alors les tables correspondant à <option>-T</option>
        sont exclues de ce qui est une sauvegarde normale.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-v</option></term>
      <term><option>--verbose</option></term>
      <listitem>
       <para>
	Mode verbeux. <application>pg_dump</application> affiche des commentaires
	détaillés sur les objets et les heures de début et de fin dans le fichier de
	sauvegarde. Des messages de progression sont également affichés sur la 
	sortie d'erreur standard.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-x</option></term>
      <term><option>--no-privileges</option></term>
      <term><option>--no-acl</option></term>
      <listitem>
       <para>
	Les privilèges d'accès (commandes grant/revoke) ne sont pas sauvegardés.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-Z <replaceable class="parameter">0..9</replaceable></option></term>
      <term><option>--compress=<replaceable class="parameter">0..9</replaceable></option></term>
      <listitem>
       <para>
        Indique le niveau de compression à utiliser. Zéro signifie sans
        compression. Pour le format d'archive personnalisé, cela signifie la
        compression des segments individuels des données des tables. Par
	défaut, la compression se fait à un niveau modéré. Pour le format texte,
        indiquer une valeur différente de zéro implique une compression du
	fichier complet, comme s'il était passé à 
        <application>gzip</application>&nbsp;; mais par défaut, la sortie n'est
        pas compressée. Le format d'archive tar ne supporte pas du tout la
        compression.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>--binary-upgrade</option></term>
      <listitem>
       <para>
        This option is for use by in-place upgrade utilities.  Its use
        for other purposes is not recommended or supported.  The
        behavior of the option may change in future releases without
        notice.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>--inserts</option></term>
      <listitem>
       <para>
        Dump data as <command>INSERT</command> commands (rather
        than <command>COPY</command>).  This will make restoration very slow;
        it is mainly useful for making dumps that can be loaded into
        non-<productname>PostgreSQL</productname> databases.
        Also, since this option generates a separate command for each row,
        an error in reloading a row causes only that row to be lost rather
        than the entire table contents.
        Note that
        the restore might fail altogether if you have rearranged column order.
        The <option>--column-inserts</option> option is safe against column
        order changes, though even slower.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>--column-inserts</option></term>
      <term><option>--attribute-inserts</option></term>
      <listitem>
       <para>
        Dump data as <command>INSERT</command> commands with explicit
        column names (<literal>INSERT INTO
        <replaceable>table</replaceable>
        (<replaceable>column</replaceable>, ...) VALUES
        ...</literal>).  This will make restoration very slow; it is mainly
        useful for making dumps that can be loaded into
        non-<productname>PostgreSQL</productname> databases.
        Also, since this option generates a separate command for each row,
        an error in reloading a row causes only that row to be lost rather
        than the entire table contents.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>--disable-dollar-quoting</option></term>
      <listitem>
       <para>
        This option disables the use of dollar quoting for function bodies,
        and forces them to be quoted using SQL standard string syntax.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>--disable-triggers</option></term>
      <listitem>
       <para>
        This option is only relevant when creating a data-only dump.
        It instructs <application>pg_dump</application> to include commands
        to temporarily disable triggers on the target tables while
        the data is reloaded.  Use this if you have referential
        integrity checks or other triggers on the tables that you
        do not want to invoke during data reload.
       </para>

       <para>
        Presently, the commands emitted for <option>--disable-triggers</option>
        must be done as superuser.  So, you should also specify
        a superuser name with <option>-S</option>, or preferably be careful to
        start the resulting script as a superuser.
       </para>

       <para>
        This option is only meaningful for the plain-text format.  For
        the archive formats, you can specify the option when you
        call <command>pg_restore</command>.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>--lock-wait-timeout=<replaceable class="parameter">timeout</replaceable></option></term>
      <listitem>
       <para>
        Do not wait forever to acquire shared table locks at the beginning of
        the dump. Instead fail if unable to lock a table within the specified
        <replaceable class="parameter">timeout</replaceable>. The timeout may be
        specified in any of the formats accepted by <command>SET
        statement_timeout</command>.  (Allowed values vary depending on the server
        version you are dumping from, but an integer number of milliseconds
        is accepted by all versions since 7.3.  This option is ignored when
        dumping from a pre-7.3 server.)
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>--no-tablespaces</option></term>
      <listitem>
       <para>
        Do not output commands to select tablespaces.
        With this option, all objects will be created in whichever
        tablespace is the default during restore.
       </para>

       <para>
        This option is only meaningful for the plain-text format.  For
        the archive formats, you can specify the option when you
        call <command>pg_restore</command>.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>--use-set-session-authorization</option></term>
      <listitem>
       <para>
        Output SQL-standard <command>SET SESSION AUTHORIZATION</command> commands
        instead of <command>ALTER OWNER</command> commands to determine object
        ownership.  This makes the dump more standards compatible, but
        depending on the history of the objects in the dump, might not restore
        properly.  Also, a dump using <command>SET SESSION
        AUTHORIZATION</command>
        will certainly require superuser privileges to restore correctly,
        whereas <command>ALTER OWNER</command> requires lesser privileges.
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </para>

   <para>
    Les options de ligne de commande suivantes gèrent les paramètres de connexion&nbsp;:

    <variablelist>
     <varlistentry>
      <term><option>-h <replaceable	class="parameter">hôte</replaceable></option></term>
      <term><option>--host <replaceable	class="parameter">hôte</replaceable></option></term>
      <listitem>
       <para>
        Le nom d'hôte de la machine sur laquelle le serveur de bases
        de données est exécuté. Si la valeur commence par une barre oblique (/),
        elle est utilisée comme répertoire pour le socket de domaine Unix.
	La valeur par défaut est fournie par la variable d'environnement
	<envar>PGHOST</envar>, si elle est initialisée. Dans le cas contraire, 
	une connexion sur la socket de domaine Unix est tentée.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-p <replaceable class="parameter">port</replaceable></option></term>
      <term><option>--port <replaceable class="parameter">port</replaceable></option></term>
      <listitem>
       <para>
        Le port TCP ou le fichier local de socket de domaine Unix
        sur lequel le serveur écoute les connexions.
	La valeur par défaut est fournie par la variable d'environnement
	<envar>PGPORT</envar>, si elle est initialisée. Dans le cas contraire,
	il s'agit de la valeur fournie à la compilation.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-U <replaceable class="parameter">nomutilisateur</replaceable></option></term>
      <term><option>--username <replaceable class="parameter">nomutilisateur</replaceable></option></term>
      <listitem>
       <para>
        Le nom d'utilisateur utilisé pour la connexion.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-w</option></term>
      <term><option>--no-password</option></term>
      <listitem>
       <para>
        Never issue a password prompt.  If the server requires
        password authentication and a password is not available by
        other means such as a <filename>.pgpass</filename> file, the
        connection attempt will fail.  This option can be useful in
        batch jobs and scripts where no user is present to enter a
        password.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-W</option></term>
      <term><option>--password</option></term>
      <listitem>
       <para>
        Force <application>pg_dump</application> à demander un mot de passe
	avant la connexion à une base de données.
       </para>

       <para>
        Cette option n'est jamais nécessaire car
        <application>pg_dump</application> demande automatiquement un
	mot de passe si le serveur exige une authentification par mot de
	passe. Néanmoins, <application>pg_dump</application> perd une
	tentative de connexion pour tester si le serveur demande un mot de
	passe. Dans certains cas, il est préférable d'ajouter l'option
        <option>-W</option> pour éviter la tentative de connexion.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>--role=<replaceable class="parameter">rolename</replaceable></option></term>
      <listitem>
       <para>
        Specifies a role name to be used to create the dump.
        This option causes <application>pg_dump</application> to issue a
        <command>SET ROLE</command> <replaceable
        class="parameter">rolename</replaceable>
        command after connecting to the database. It is useful when the
        authenticated user (specified by <option>-U</option>) lacks privileges
        needed by <application>pg_dump</application>, but can switch to a role with
        the required rights.  Some installations have a policy against
        logging in directly as a superuser, and use of this option allows
        dumps to be made without violating the policy.
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </para>
 </refsect1>

 <refsect1>
  <title>Environnement</title>

  <variablelist>
   <varlistentry>
    <term><envar>PGDATABASE</envar></term>
    <term><envar>PGHOST</envar></term>
    <term><envar>PGOPTIONS</envar></term>
    <term><envar>PGPORT</envar></term>
    <term><envar>PGUSER</envar></term>

    <listitem>
     <para>
      Paramètres de connexion par défaut.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <para>
   Cet outil, comme la plupart des autres outils <productname>PostgreSQL</productname>,
   utilise les variables d'environnement supportées par la bibliothèque
   <application>libpq</application> (voir <xref linkend="libpq-envars"/>).
  </para>

 </refsect1>

 <refsect1 id="app-pgdump-diagnostics">
  <title>Diagnostiques</title>

  <para>
   <application>pg_dump</application> exécute intrinsèquement des instructions
   <command>SELECT</command>. Si des problèmes apparaissent à l'exécution de
   <application>pg_dump</application>, <xref linkend="app-psql"/> peut être 
   utilisé pour s'assurer qu'il est possible de sélectionner des informations
   dans la base de données. De plus,
   tout paramètre de connexion par défaut et toute variable d'environnement
   utilisé par la bibliothèque <application>libpq</application> s'appliquent.
  </para>

  <para>
   The database activity of <application>pg_dump</application> is
   normally collected by the statistics collector.  If this is
   undesirable, you can set parameter <literal>track_counts</literal>
   to false via <envar>PGOPTIONS</envar> or the <literal>ALTER
   USER</literal> command.
  </para>
 </refsect1>


 <refsect1 id="pg-dump-notes">
  <title>Notes</title>

  <para>
   Si des ajouts locaux à la base <literal>template1</literal> ont été
   effectués, il est impératif de s'assurer que la 
   sortie de <application>pg_dump</application> est effectivement restaurée
   dans une base vide&nbsp;; dans le cas contraire, il est fort probable 
   que la duplication des définitions des objets ajoutés engendre des erreurs.
   Pour obtenir une base vide de tout ajout local, on utilise <literal>template0</literal>
   à la place de <literal>template1</literal> comme modèle.
   Par exemple&nbsp;:
<programlisting>CREATE DATABASE foo WITH TEMPLATE template0;
</programlisting>
  </para>

  <para>
   Quand une sauvegarde des seules données est sélectionnée et que l'option
   <option>--disable-triggers</option> est utilisée,
   <application>pg_dump</application> engendre des commandes de désactivation
   des déclencheurs sur les tables utilisateur avant l'insertion des données, puis
   après coup, des commandes de réactivation après l'insertion. Si la restauration est
   interrompue, il se peut que les catalogues systèmes conservent cette
   position.
  </para>

  <para>
   Les fichiers d'une archive tar sont limités à une taille inférieure à
   8&nbsp;Go. (C'est une limitation inhérente au format des fichiers tar.) 
   Ce format ne peut donc pas être utilisé si la représentation textuelle
   d'une table dépasse cette taille. La taille totale d'une archive tar et de
   tout autre format de sortie n'est pas limitée, sauf peut-être par le système
   d'exploitation.
  </para>

  <para>
   Le fichier de sauvegarde produit par <application>pg_dump</application> ne
   contient pas les statistiques utilisées par l'optimiseur pour la
   planification des requêtes. Il est donc conseillé, pour assurer des
   performances correctes, de lancer <command>ANALYZE</command> après
   la restauration d'une sauvegarde. Le fichier de sauvegarde ne contient pas
   non plus de commandes <command>ALTER DATABASE ... SET</command>&nbsp;; ces
   paramètres sont sauvegardés par <xref linkend="app-pg-dumpall"/>, avec les
   utilisateurs et les paramètres globaux à l'installation.
  </para>

  <para>
   Because <application>pg_dump</application> is used to transfer data
   to newer versions of <productname>PostgreSQL</productname>, the output of
   <application>pg_dump</application> can be expected to load into
   <productname>PostgreSQL</productname> server versions newer than
   <application>pg_dump</application>'s version.
   <application>pg_dump</application> can also
   dump from <productname>PostgreSQL</productname> servers older than its own version.
   (Currently, servers back to version 7.0 are supported.)
   However, <application>pg_dump</application> cannot dump from
   <productname>PostgreSQL</productname> servers newer than its own major version;
   it will refuse to even try, rather than risk making an invalid dump.
   Also, it is not guaranteed that <application>pg_dump</application>'s output can
   be loaded into a server of an older major version &mdash; not even if the
   dump was taken from a server of that version.  Loading a dump file
   into an older server may require manual editing of the dump file
   to remove syntax not understood by the older server.
  </para>
 </refsect1>

 <refsect1 id="pg-dump-examples">
  <title>Exemples</title>

  <para>
   Sauvegarder une base appelée <literal>ma_base</literal> dans un script
   SQL&nbsp;:
<screen><prompt>$</prompt> <userinput>pg_dump ma_base &gt; base.sql</userinput>
</screen>
  </para>

  <para>
   Charger ce script dans une base nouvellement créée et nommée
   <literal>nouvelle_base</literal>:

<screen><prompt>$</prompt> <userinput>psql -d nouvelle_base -f base.sql</userinput>
</screen>
  </para>

  <para>
   Sauvegarder une base dans un fichier au format personnalisé&nbsp;:

<screen><prompt>$</prompt> <userinput>pg_dump -Fc ma_base &gt; base.dump</userinput>
</screen>
  </para>

  <para>
   Charger un fichier d'archive dans une nouvelle base nommée
   <literal>nouvelle_base</literal>&nbsp;:

<screen><prompt>$</prompt> <userinput>pg_restore -d nouvelle_base base.dump</userinput>
</screen>
  </para>

  <para>
   Sauvegarder la table nommée <literal>mytab</literal>&nbsp;:

<screen><prompt>$</prompt> <userinput>pg_dump -t ma_table ma_base &gt; base.sql</userinput>
</screen>
  </para>

  <para>
   Sauvegarder toutes les tables du schéma <literal>detroit</literal> et
   dont le nom commence par <literal>emp</literal> sauf la table nommée
   <literal>traces_employes</literal>&nbsp;:

<screen><prompt>$</prompt> <userinput>pg_dump -t 'detroit.emp*' -T detroit.traces_employes ma_base &gt; base.sql</userinput>
</screen>
  </para>

  <para>
   Sauvegarder tous les schémas dont le nom commence par <literal>est</literal> ou
   <literal>ouest</literal> et se termine par <literal>gsm</literal>, en excluant les schémas
   dont le nom contient le mot <literal>test</literal>&nbsp;:

<screen>
<prompt>$</prompt> <userinput>pg_dump -n 'est*gsm' -n 'ouest*gsm' -N '*test*' ma_base &gt; base.sql</userinput>
</screen>
  </para>

  <para>
   Idem mais en utilisant des expressions rationnelles dans les options&nbsp;:

<screen><prompt>$</prompt> <userinput>pg_dump -n '(est|ouest)*gsm' -N '*test*' ma_base &gt; base.sql</userinput>
</screen>
  </para>

  <para>
   Sauvegarder tous les objets de la base sauf les tables dont le nom
   commence par <literal>ts_</literal>&nbsp;:

<screen><prompt>$</prompt> <userinput>pg_dump -T 'ts_*' ma_base &gt; base.sql</userinput>
</screen>
  </para>

  <para>
   Pour indiquer un nom qui comporte des majuscules dans les options
   <option>-t</option> et assimilées, il faut ajouter des guillemets
   doubles&nbsp;; sinon le nom est converti en minuscules (voir<xref
   linkend="app-psql-patterns" endterm="app-psql-patterns-title"/>). Les
   guillemets doubles sont interprétés par le shell et doivent dont être placés
   entre guillemets. Du coup, pour sauvegarder une seule table dont le nom
   comporte des majuscules, on utilise une commande du style&nbsp;:

<screen>
<prompt>$</prompt> <userinput>pg_dump -t '"NomAMajuscule"' ma_base &gt; ma_base.sql</userinput>
</screen>
  </para>

 </refsect1>

 <refsect1>
  <title>Voir aussi</title>

  <simplelist type="inline">
   <member><xref linkend="app-pg-dumpall"/></member>
   <member><xref linkend="app-pgrestore"/></member>
   <member><xref linkend="app-psql"/></member>
  </simplelist>
 </refsect1>

</refentry>
