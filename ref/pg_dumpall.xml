<?xml version="1.0" encoding="ISO-8859-1"?>
<!--
$Header: /var/lib/cvs/pgsql-fr/sgml/ref/pg_dumpall.sgml,v 1.8 2005/09/15 07:03:27 guillaume Exp $
PostgreSQL documentation
-->

<refentry id="app-pg-dumpall">
 <refmeta>
  <refentrytitle id="app-pg-dumpall-title"><application>pg_dumpall</application></refentrytitle>
  <manvolnum>1</manvolnum>
  <refmiscinfo>Application</refmiscinfo>
 </refmeta>

 <refnamediv>
  <refname>pg_dumpall</refname>
  <refpurpose>extrait un groupe de bases de données
   <productname>PostgreSQL</productname> dans un fichier script
  </refpurpose>
 </refnamediv>

 <refsynopsisdiv>
  <cmdsynopsis>
   <command>pg_dumpall</command>
   <arg rep="repeat"><replaceable>option</replaceable></arg>
  </cmdsynopsis>
 </refsynopsisdiv>

 <refsect1 id="app-pg-dumpall-description">
  <title>Description</title>
  <indexterm zone="app-pg-dumpall">
   <primary>pg_dumpall</primary>
  </indexterm>


  <para>
   <application>pg_dumpall</application> est un outil pour extraire
   (<quote>sauvegarder</quote>) toutes les bases de données
   <productname>PostgreSQL</productname> d'un groupe dans un fichier script. Celui-ci
   contient les commandes <acronym>SQL</acronym> pouvant être utilisées pour
   restaurer les bases de données avec <xref linkend="app-psql"/>. Il fait ceci
   en appelant <xref linkend="app-pgdump"/> pour chaque base de données du
   groupe. <application>pg_dumpall</application> sauvegarde aussi les objets
   globaux, communs à toutes les bases de données.
   (<application>pg_dump</application> ne sauvegarde pas ces objets.) Cela
   inclut aussi les informations concernant les utilisateurs et groupes de la
   base de données ainsi que les droits d'accès s'appliquant aux bases de
   données.
  </para>

  <para>
   Comme <application>pg_dumpall</application> lit les tables de
   toutes les bases de données, il est en pratique nécessaire d'avoir les droits de
   superutilisateur des bases de données pour avoir une sauvegarde complète. 
   De plus, il faut des droits de superutilisateur à l'exécution du script
   produit, pour avoir le droit de créer des utilisateurs et des groupes et
   de créer des bases de données.
  </para>

  <para>
   Le script SQL écrit sur la sortie standard. Les opérateurs shell doivent
   être utilisés pour la rediriger dans un fichier.
  </para>

  <para>
  <application>pg_dumpall</application> a besoin de se connecter plusieurs fois
   au serveur <productname>PostgreSQL</productname> (une fois par base de
   données). Si vous utilisez l'authentification par mot de passe, il pourrait
   avoir besoin de demander un mot de passe à chaque fois. Il est intéressant
   d'avoir un fichier <filename>~/.pgpass</filename> dans de tels cas. Voir <xref
   linkend="libpq-pgpass"/> pour plus d'informations.
  </para>

 </refsect1>

 <refsect1>
  <title>Options</title>

   <para>
    Les options suivantes en ligne de commande contrôlent le contenu et le
    format de la sortie.

    <variablelist>
     <varlistentry>
      <term><option>-a</option></term>
      <term><option>--data-only</option></term>
      <listitem>
       <para>
	Sauvegarde seulement les données, pas le schéma (définition des
	données).
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-c</option></term>
      <term><option>--clean</option></term>
      <listitem>
       <para>
	Inclut les commandes SQL pour nettoyer (supprimer) les bases de données
	avant de les recréer. Des commandes <command>DROP</command> sont ajoutées pour
	les rôles et les espaces logiques.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-d</option></term>
      <term><option>--inserts</option></term>
      <listitem>
       <para>
	Sauvegarde les données en tant que commandes <command>INSERT</command>
	(plutôt que des <command>COPY</command>). Ceci ralentit la
	restauration&nbsp;; c'est principalement utile pour créer des
	sauvegardes qui peuvent être chargées dans des bases de données autres
	que <productname>PostgreSQL</productname>. Notez que la restauration
	pourrait aussi échouer si vous avez modifié l'ordre des colonnes.
	L'option <option>-D</option> est plus sûre, bien que plus lente.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-D</option></term>
      <term><option>--column-inserts</option></term>
      <term><option>--attribute-inserts</option></term>
      <listitem>
       <para>
	Sauvegarde les données en tant que commandes <command>INSERT</command>
	avec les noms de colonnes explicites (<literal>INSERT INTO
	<replaceable>table</replaceable>
	(<replaceable>colonne</replaceable>, ...) VALUES
	...</literal>). Ceci ralentit la restauration&nbsp;; c'est
	principalement utile pour créer des sauvegardes qui peuvent être
	chargées dans des bases de données autres que
	<productname>PostgreSQL</productname>.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-g</option></term>
      <term><option>--globals-only</option></term>
      <listitem>
       <para>
	Sauvegarde seulement les objets globaux (utilisateurs et groupes), pas
	les bases de données.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-i</option></term>
      <term><option>--ignore-version</option></term>
      <listitem>
       <para>
        Ignore la différence de version entre
        <application>pg_dumpall</application> et le serveur de bases de données.
       </para>

       <para>
        <application>pg_dumpall</application> peut sauvegarder des bases de données
	de versions précédentes de <productname>PostgreSQL</productname>, mais les
	très anciennes versions ne sont plus supportées (avant la 7.0). Utilisez
	cette option si vous avez besoin de surcharger la vérification de la
	version (et si <application>pg_dumpall</application> échoue, ne dites
	pas que vous n'avez pas été prévenu).
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-o</option></term>
      <term><option>--oids</option></term>
      <listitem>
       <para>
	Sauvegarde les identifiants des objets (<acronym>OID</acronym>) comme
	faisant partie des données de chaque table. Utilisez cette option si
	votre application référence les colonnes <acronym>OID</acronym> (par
	exemple, dans une contrainte de clé étrangère). Sinon, cette option ne
	doit pas être utilisée.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-O</option></term>
      <term><option>--no-owner</option></term>
      <listitem>
       <para>
        Ne produit pas les commandes pour mettre les propriétaires des objets
	à ceux de la base de données originale. Par défaut,
	<application>pg_dumpall</application> lance les instructions
	<command>ALTER OWNER</command> ou <command>SET SESSION AUTHORIZATION</command>
	pour configurer le propriétaire des éléments créés. Ces instructions
	échouent lorsque le script est lancé par un utilisateur ne disposant
	pas des droits de superutilisateur (ou ne possédant pas les droits du
	propriétaire de tous les objets compris dans ce script). Pour que ce
	script puisse être restauré par n'importe quel utilisateur mais donne la
	propriété des objets à l'utilisateur l'exécutant, spécifiez
	<option>-O</option>.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-s</option></term>
      <term><option>--schema-only</option></term>
      <listitem>
       <para>
	Sauvegarde seulement les définitions des objets (schéma), pas les
	données.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-S <replaceable
	class="parameter">username</replaceable></option></term>
      <term><option>--superuser=<replaceable
	class="parameter">username</replaceable></option></term>
      <listitem>
       <para>
        Spécifie le nom du superutilisateur à utiliser lors de la désactivation
	des déclencheurs. Ceci est seulement pris en compte si
	<option>--disable-triggers</option> est utilisé. (Habituellement, il est
	mieux de ne pas utiliser cette option et de lancer à la place le script résultant
	en tant que superutilisateur.)
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-v</option></term>
      <term><option>--verbose</option></term>
      <listitem>
       <para>
	Spécifie le mode verbeux. Ceci fait que
	<application>pg_dumpall</application> affiche les heures de
	démarrage/arrêt dans le fichier de sauvegarde et les messages de
	progression sur la sortie standard. Il active aussi la sortie verbeuse
	dans <application>pg_dump</application>.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-x</option></term>
      <term><option>--no-privileges</option></term>
      <term><option>--no-acl</option></term>
      <listitem>
       <para>
	Empêche la sauvegarde des droits d'accès (commandes grant/revoke).
       </para>
      </listitem>
     </varlistentry>
     
     <varlistentry>
      <term><option>-X disable-dollar-quoting</option></term>
      <term><option>--disable-dollar-quoting</option></term>
      <listitem>
       <para>
        Cette option désactive l'utilisation du dollar comme guillemet pour 
	les corps des fonctions et le force à être entre guillemets en utilisant
	la syntaxe standard du SQL.
       </para>
     </listitem>
    </varlistentry>

     <varlistentry>
      <term><option>-X disable-triggers</option></term>
      <term><option>--disable-triggers</option></term>
      <listitem>
       <para>
        Cette option est utile uniquement lors de la création d'une sauvegarde
	des données seules. Elle indique à <application>pg_dumpall</application>
	d'inclure les commandes pour désactiver temporairement les déclencheurs
	sur les tables cibles alors que les données sont rechargées. Utilisez
	ceci si vous avez des vérifications d'intégrité référencielle ou d'autres
	déclencheurs sur les tables que vous ne voulez pas appeler lors du
	rechargement des données.
       </para>

       <para>
        Actuellement, les commandes émises pour <option>--disable-triggers</option>
	doivent être lancées en tant que superutilisateur. Donc, vous devez
	aussi spécifier un nom de superutilisateur avec <option>-S</option> ou,
	mieux, lancer le script résultant en tant que superutilisateur.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-X use-set-session-authorization</option></term>
      <term><option>--use-set-session-authorization</option></term>
      <listitem>
       <para>
        Affiche les commandes <command>SET SESSION AUTHORIZATION</command> du standard
	SQL à la place des commandes <command>ALTER OWNER</command> pour initialiser le
	propriétaire de l'objet. Ceci rend la sauvegarde plus compatible avec
	les standards mais, suivant l'historique des objets dans la sauvegarde,
	pourrait ne pas être restauré proprement.
       </para>
      </listitem>
     </varlistentry>

    </variablelist>
   </para>

  <para>
   Les options suivantes de la ligne de commande contrôlent les paramètres de
   connexion à la base de données.

   <variablelist>
     <varlistentry>
      <term>-h <replaceable>hôte</replaceable></term>
      <listitem>
       <para>
	Spécifie le nom d'hôte de la machine sur laquelle le serveur de bases de
	données est en cours d'exécution. Si la valeur commence avec un slash,
	elle est utilisée comme répertoire du socket de domaine Unix. La valeur
	par défaut est prise à partir de la variable d'environnement
	<envar>PGHOST</envar>, si elle est initialisée, sinon une connexion
	socket de domaine Unix est tentée.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term>-p <replaceable>port</replaceable></term>
      <listitem>
       <para>
	Spécifie le port TCP ou l'extension du fichier socket de domaine Unix
	local sur lequel le serveur est en écoute des connexions. La valeur par défaut
	est la variable d'environnement <envar>PGPORT</envar>, si elle est
	initialisée, ou la valeur compilée.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term>-U <replaceable>nomutilisateur</replaceable></term>
      <listitem>
       <para>
        Se connecter en tant que cet utilisateur.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term>-W</term>
      <listitem>
       <para>
        Force une demande de mot de passe. Ceci devrait arriver automatiquement
	si le serveur réclame une authentification par mot de passe.
       </para>
      </listitem>
     </varlistentry>
   </variablelist>
  </para>
 </refsect1>


 <refsect1>
  <title>Environnement</title>

  <variablelist>
   <varlistentry>
    <term><envar>PGHOST</envar></term>
    <term><envar>PGPORT</envar></term>
    <term><envar>PGUSER</envar></term>

    <listitem>
     <para>
      Paramètres de connexion par défaut
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </refsect1>


 <refsect1>
  <title>Notes</title>

  <para>
   Comme <application>pg_dumpall</application> appelle
   <application>pg_dump</application> en interne, certains messages de
   diagnostique se réfèrent en fait à <application>pg_dump</application>.
  </para>

  <para>
   Une fois la restauration effectuée, il est conseillé de lancer 
   <command>ANALYZE</command> sur chaque
   base de données, de façon à ce que l'optimiseur dispose de statistiques
   utiles. Vous pouvez aussi lancer <command>vacuumdb -a -z</command> pour analyser
   toutes les bases de données.
  </para>

 </refsect1>


 <refsect1 id="app-pg-dumpall-ex">
  <title>Exemples</title>
  <para>
   Pour sauvegarder toutes les bases de données&nbsp;:

<screen><prompt>$</prompt> <userinput>pg_dumpall &gt; db.out</userinput>
</screen>
  </para>

  <para>
   Pour recharger cette base de données, utilisez par exemple&nbsp;:
<screen><prompt>$</prompt> <userinput>psql -f db.out postgres</userinput>
</screen>
   (La base de données à laquelle vous vous connectez n'a pas d'importance ici
   car le fichier de script créé par <application>pg_dumpall</application>
   contient les commandes appropriées pour créer et se connecter aux bases
   de données sauvegardées.)
  </para>
 </refsect1>

 <refsect1>
  <title>Voir aussi</title>

  <para>
    <xref linkend="app-pgdump"/>. Vous trouverez ici les détails sur les messages
    d'erreurs possibles. Voir aussi les variables d'environnement supportées
    (<xref linkend="libpq-envars"/>).
  </para>
 </refsect1>   

</refentry>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:nil
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
sgml-parent-document:nil
sgml-default-dtd-file:"../reference.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:"/usr/lib/sgml/catalog"
sgml-local-ecat-files:nil
End:
-->
