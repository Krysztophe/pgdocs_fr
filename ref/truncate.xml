<?xml version="1.0" encoding="UTF-8"?>
<!-- Dernière modification
     le       $Date$
     par      $Author$
     révision $Revision$ -->
<!-- SAS 20060301 pour la relecture -->

<refentry id="sql-truncate">
 <refmeta>
  <refentrytitle id="sql-truncate-title">TRUNCATE</refentrytitle>
  <refmiscinfo>SQL - Instructions du langage</refmiscinfo>
 </refmeta>

 <refnamediv>
  <refname>TRUNCATE</refname>
  <refpurpose>vide une table ou un ensemble de tables</refpurpose>
 </refnamediv>

 <refsynopsisdiv>
	 <synopsis>TRUNCATE [ TABLE ] <replaceable class="parameter">nom</replaceable> [, ...] [ CASCADE | RESTRICT ]
</synopsis>
 </refsynopsisdiv>

 <refsect1>
  <title>Description</title>
  <indexterm zone="sql-truncate">
   <primary>TRUNCATE</primary>
  </indexterm>

  <para>
   La commande <command>TRUNCATE</command> supprime rapidement toutes les
   lignes d'un ensemble de tables. Elle a le même effet qu'un
   <command>DELETE</command> non qualifié sur chaque table, mais comme elle ne
   parcourt par la table, elle est plus rapide. De plus, elle récupère
   immédiatement l'espace disque, évitant ainsi une opération
   <command>VACUUM</command>. Cette commande est particulièrement utile pour
   les tables volumineuses.
  </para>
 </refsect1>
  
 <refsect1>
  <title>Paramètres</title>

  <variablelist>
   <varlistentry>
    <term><replaceable class="parameter">name</replaceable></term>
    <listitem>
     <para>
      Le nom d'une table à vider (peut être qualifié par le schéma).
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><literal>CASCADE</literal></term>
    <listitem>
     <para>
      Vide toutes les tables qui ont des références de clés étrangères sur une
      des tables nommées et sur toute table ajoutée au groupe à cause du
      <literal>CASCADE</literal>.
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><literal>RESTRICT</literal></term>
    <listitem>
     <para>
      Refuse le vidage si une des tables a des références de clés étrangères
      sur une table qui ne doit pas être vidée. Cette option est active par
      défaut.
     </para>
    </listitem>
   </varlistentry>
  </variablelist>
 </refsect1>

 <refsect1>
  <title>Notes</title>

  <para>
   Seul le propriétaire d'une table peut la vider (<command>TRUNCATE</command>).
  </para>

  <para>
   <command>TRUNCATE</command> ne peut pas être utilisé sur une table
   référencée par d'autres tables au travers de clés étrangères, sauf si ces
   tables sont aussi comprises dans la commande. Dans le cas contraire, la
   vérification nécessiterait des parcours complets de tables, ce qui n'est pas
   le but de la commande <command>TRUNCATE</command>. L'option
   <literal>CASCADE</literal> est utilisable pour inclure automatiquement
   toutes les tables dépendantes &mdash; faites attention lorsque vous utilisez
   cette option parce que vous pourriez perdre des données que vous auriez
   souhaitez conserver&nbsp;!
  </para>

  <para>
   <command>TRUNCATE</command> n'exécutera aucun trigger <literal>ON
   DELETE</literal> qui pourrait exister sur les tables.
  </para>

  <warning>
   <para>
    <command>TRUNCATE</command> n'est pas compatible avec MVCC (voir <xref
     linkend="mvcc"/> pour des informations générales sur MVCC). Après un
    vidage, la table apparaîtra vide pour toutes les transactions en cours
    même si elles utilisent une image prise avant le début du vidage. Ceci
    est un problème pour une transaction qui n'a pas eu un accès à la table
    avant le vidage &mdash; toute transaction qui y a accédé avant détient
    au moins un verrou <literal>ACCESS SHARE</literal> qui bloquera
    <command>TRUNCATE</command> jusqu'à la fin de la transaction. Donc le
    vidage ne causera aucune incohérence apparente dans le contenu de la
    table pour des requêtes successives sur la même table, mais il causera
    une incohérence visble entre la table tronquée et les autres tables de
    la base.
   </para>

   <para>
    Néanmoins, <command>TRUNCATE</command> est compatible avec le système des
    transactions&nbsp;: un tronquage pourrait être annulée si la transaction en
    cours n'est pas validée.
   </para>
  </warning>
 </refsect1>

 <refsect1>
  <title>Exemples</title>

  <para>
   Vider les tables <literal>grossetable</literal> et
   <literal>grandetable</literal>&nbsp;:

<programlisting>TRUNCATE grossetable, grandetable;
</programlisting>
  </para>
  
  <para>
   Vide la table <literal>uneautretable</literal>, et cascade cela à toutes
   les tables qui référencent <literal>uneautretable</literal> via des
   contraintes de clés étrangères&nbsp;:

<programlisting>
TRUNCATE uneautretable CASCADE;
</programlisting>
  </para>
 </refsect1>
 
 <refsect1>
  <title>Compatibilité</title>

  <para>
   Il n'existe pas de commande <command>TRUNCATE</command> dans le standard SQL.
  </para>
 </refsect1>
</refentry>
