<!--
$Header: /var/lib/cvs/pgsql-fr/sgml/ref/pg_ctl-ref.sgml,v 1.9 2005/07/10 17:28:01 guillaume Exp $
PostgreSQL documentation
-->

<refentry id="app-pg-ctl">
 <refmeta>
  <refentrytitle id="app-pg-ctl-title"><application>pg_ctl</application></refentrytitle>
  <manvolnum>1</manvolnum>
  <refmiscinfo>Application</refmiscinfo>
 </refmeta>

 <refnamediv>
  <refname>pg_ctl</refname>
  <refpurpose>lance, arrête ou relance le serveur
  <productname>PostgreSQL</productname></refpurpose>
 </refnamediv>

 <indexterm zone="app-pg-ctl">
  <primary>pg_ctl</primary>
 </indexterm>

 <refsynopsisdiv>
  <cmdsynopsis>
   <command>pg_ctl</command>
   <arg choice="plain">start</arg>
   <arg>-w</arg>
   <arg>-s</arg>
   <arg>-D <replaceable>répertoire_données</replaceable></arg>
   <arg>-l <replaceable>nomfichier</replaceable></arg>
   <arg>-o <replaceable>options</replaceable></arg>
   <arg>-p <replaceable>chemin</replaceable></arg>
   <sbr>
   <command>pg_ctl</command>
   <arg choice="plain">stop</arg>
   <arg>-W</arg>
   <arg>-s</arg>
   <arg>-D <replaceable>répertoire_données</replaceable></arg>
   <arg>-m
     <group choice="plain">
       <arg>s[mart]</arg>
       <arg>f[ast]</arg>
       <arg>i[mmediate]</arg>
     </group>
   </arg>
   <sbr>
   <command>pg_ctl</command>
   <arg choice="plain">restart</arg>
   <arg>-w</arg>
   <arg>-s</arg>
   <arg>-D <replaceable>répertoire_données</replaceable></arg>
   <arg>-m
     <group choice="plain">
       <arg>s[mart]</arg>
       <arg>f[ast]</arg>
       <arg>i[mmediate]</arg>
     </group>
   </arg>
   <arg>-o <replaceable>options</replaceable></arg>
   <sbr>
   <command>pg_ctl</command>
   <arg choice="plain">reload</arg>
   <arg>-s</arg>
   <arg>-D <replaceable>répertoire_données</replaceable></arg>
   <sbr>
   <command>pg_ctl</command>
   <arg choice="plain">status</arg>
   <arg>-D <replaceable>répertoire_données</replaceable></arg>
   <sbr>
   <command>pg_ctl</command>
   <arg choice="plain">kill</arg>
   <arg><replaceable>nom_signal</replaceable></arg>
   <arg><replaceable>id_processus</replaceable></arg>
   <sbr>
   <command>pg_ctl</command>
   <arg choice="plain">register</arg>
   <arg>-N <replaceable>nom_service</replaceable></arg>
   <arg>-U <replaceable>nom_utilisateur</replaceable></arg>
   <arg>-P <replaceable>mot_de_passe</replaceable></arg>
   <arg>-D <replaceable>répertoire_données</replaceable></arg>
   <arg>-w</arg>
   <arg>-o <replaceable>options</replaceable></arg>
   <sbr>
   <command>pg_ctl</command>
   <arg choice="plain">unregister</arg>
   <arg>-N <replaceable>nom_service</replaceable></arg>
  </cmdsynopsis>
 </refsynopsisdiv>


 <refsect1 id="app-pg-ctl-description">
  <title>Description</title>
  <para>
   <application>pg_ctl</application> est un outil de lancement, d'arrêt et de
   redémarrage du serveur <productname>PostgreSQL</productname> (<xref
   linkend="app-postmaster">). Il permet aussi d'afficher le statut d'un serveur
   en cours d'exécution. Bien que le serveur doive être lancé manuellement,
   <application>pg_ctl</application> encapsule les tâches comme la redirection
   des traces ou le détachement du terminal et du groupe de processus. Il fournit
   aussi des options intéressantes pour un arrêt contrôlé.
  </para>

  <para>
   Dans le mode <option>start</option>, un nouveau serveur est lancé. Le
   serveur est lancé en tâche de fond et l'entrée standard est attachée à
   <filename>/dev/null</filename>. La sortie standard et la sortie d'erreurs
   standard sont soit envoyées dans un journal de traces (si l'option
   <option>-l</option> est utilisée) soit redirigées dans la sortie standard de
   <application>pg_ctl</application> (et non pas la sortie d'erreurs standard).
   Si aucun journal de traces n'est donné, la sortie standard de
   <application>pg_ctl</application> devrait être redirigée dans un fichier ou
   envoyée via un tube à un autre processus, par exemple un programme de
   rotation de journaux de trace, comme <application>rotatelogs</application>
   sinon <command>postmaster</command> écrit sa sortie dans le terminal de
   contrôle (à partir de l'arrière-plan) et ne se détache pas du groupe de
   processus du shell.
  </para>

  <para>
   Dans le mode <option>stop</option>, le serveur en cours d'exécution dans le
   répertoire spécifié est arrêté. Trois méthodes différentes d'arrêt peuvent
   être choisies avec l'option <option>-m</option>&nbsp;: le mode
   <quote>Smart</quote> attend la déconnexion de tous les clients. C'est la
   valeur par défaut. Le mode <quote>Fast</quote> n'attend pas la déconnexion
   des clients. Toutes les transactions actives sont annulées et les clients
   sont forcés à se déconnecter. Le serveur est ensuite arrêté. Le mode
   <quote>Immediate</quote> tue tous les processus serveurs sans leur laisser
   la possibilité de faire un arrêt propre. 
   Ceci amènera une tentative de récupération au prochain lancement.
  </para>

  <para>
   Le mode <option>restart</option> exécute en fait un arrêt suivi d'un
   lancement. Ceci permet de modifier les options en ligne de commande de
   <command>postmaster</command>.
  </para>

  <para>
   Le mode <option>reload</option> envoie simplement au processus
   <command>postmaster</command> un signal <systemitem>SIGHUP</> ce qui le fait
   relire ses fichiers de configuration (<filename>postgresql.conf</filename>,
   <filename>pg_hba.conf</filename>, etc.). Ceci permet de modifier les options
   du fichier de configuration sans nécessiter un redémarrage complet pour que les
   modifications soient prises en compte.
  </para>

  <para>
   Le mode <option>status</option> vérifie si un serveur est toujours en cours
   d'exécution sur le répertoire de données spécifié. Si c'est le cas, le
   <acronym>PID</acronym> et les options en ligne de commande utilisées lors de
   son lancement sont affichés.
  </para>

  <para>
   Le mode <option>kill</option> vous permet d'envoyer un signal à un processus
   spécifique. Ceci est particulièrement utile pour <productname>Microsoft
   Windows</>, qui ne possède pas de commande <application>kill</>. Utilisez
   <literal>--help</> pour voir une liste des noms de signaux supportés.
  </para>

  <para>
   Le mode <option>register</option> vous permet d'enregistrer un service
   système sur <productname>Microsoft Windows</>.
  </para>

  <para>
   Le mode <option>unregister</option> vous permet d'annuler un service système
   sur <productname>Microsoft Windows</>, précédemment enregistré avec la commande
   <option>register</option>.
  </para>
 </refsect1>

 <refsect1 id="app-pg-ctl-options">
  <title>Options</title>

  <para>

    <variablelist>
     <varlistentry>
      <term><option>-D <replaceable
class="parameter">répertoire_données</replaceable></option></term>
      <listitem>
       <para>
	Spécifie l'emplacement des fichiers de la base de données sur le
	système de fichiers. Si cette option est omise, la variable d'environnement
	<envar>PGDATA</envar> est utilisée.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-l <replaceable
class="parameter">nomfichier</replaceable></option></term>
      <listitem>
       <para>
	Ajoute la sortie des traces du serveur dans
	<replaceable>nomfichier</replaceable>. Si le fichier n'existe pas, il
	est créé. L'<systemitem>umask</> est configuré à 077, donc l'accès au
	journal des traces est interdit aux autres utilisateurs par
	défaut.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-m <replaceable class="parameter">mode</replaceable></option></term>
      <listitem>
       <para>
	Spécifie le mode d'arrêt. <replaceable>mode</replaceable> fait partie de
	<literal>smart</literal>, <literal>fast</literal> ou
	<literal>immediate</literal>, ou encore de la première lettre d'un de ces
	trois-là.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-o <replaceable class="parameter">options</replaceable></option></term>
      <listitem>
       <para>
        Spécifie les options à passer directement à la commande
        <command>postmaster</command>.
       </para>
       <para>
       
	Les options sont habituellement entourées par des guillemets simples
	ou doubles pour s'assurer qu'elles sont passées comme un groupe.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-p <replaceable
class="parameter">chemin</replaceable></option></term>
      <listitem>
       <para>
	Spécifie l'emplacement de l'exécutable <filename>postmaster</filename>.
	Par défaut, l'exécutable <filename>postmaster</filename> est pris à
	partir du même répertoire que <command>pg_ctl</command> ou, si cela
	échoue, à partir du répertoire d'installation codé en dur. Il n'est pas
	nécessaire d'utiliser cette option sauf si vous faites quelque chose
	d'inhabituel et obtenez des erreurs comme quoi l'exécutable
	<filename>postmaster</filename> serait introuvable.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-s</option></term>
      <listitem>
       <para>
        Affiche seulement les erreurs, pas les messages d'information.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-w</option></term>
      <listitem>
       <para>
	Attend la fin du lancement ou de l'arrêt. S'interrompt au bout de 60
	secondes. Ceci est la valeur par défaut pour les arrêts. Un arrêt avec
	succès est indiqué par la suppression du fichier <acronym>PID</acronym>.
	Pour le lancement, un <command>psql -l</command> se terminant avec
	succès indique que tout va bien. <command>pg_ctl</command> tente
	d'utiliser le bon port pour <application>psql</>. Si la variable
	d'environnement <envar>PGPORT</envar> existe, elle est utilisée. Sinon,
	il cherche si un port a été configuré dans le fichier
	<filename>postgresql.conf</filename>. Si aucun des deux n'est utilisé,
	il utilise le port par défaut avec lequel
	<productname>PostgreSQL</productname> a été compilé (5432 par défaut).
	S'il a attendu, <command>pg_ctl</command> renvoie un code de sortie
	précis basé sur le succès du démarrage ou de l'arrêt.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-W</option></term>
      <listitem>
       <para>
	Ne pas attendre le lancement ou l'arrêt pour se terminer. Ceci est la
	valeur par défaut pour les lancements et redémarrages.
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </para>
 </refsect1>


 <refsect1 id="app-pg-ctl-svcoptions">
   <title>Options Windows</title>
   <para>
     <variablelist>
       <varlistentry>
         <term><option>-N <replaceable class="parameter">nom_service</replaceable></option></term>
         <listitem>
           <para>
             Nom du service système à enregistrer. Le nom est utilisé à la fois
	     comme nom de service et comme nom affiché.
           </para>
         </listitem>
       </varlistentry>

       <varlistentry>
         <term><option>-P <replaceable class="parameter">mot_de_passe</replaceable></option></term>
         <listitem>
           <para>
             Mot de passe de l'utilisateur pour lancer le service.
           </para>
         </listitem>
       </varlistentry>

       <varlistentry>
         <term><option>-U <replaceable class="parameter">nom_utilisateur</replaceable></option></term>
         <listitem>
           <para>
             Nom de l'utilisateur qui va lancer le service. Pour les utilisateurs
	     de domaine, utilisez le format <literal>DOMAIN\nom_utilisateur</literal>.
           </para>
         </listitem>
       </varlistentry>
     </variablelist>
   </para>
 </refsect1>


 <refsect1>
  <title>Environnement</title>

  <variablelist>
   <varlistentry>
    <term><envar>PGDATA</envar></term>

    <listitem>
     <para>
      Emplacement du répertoire des données par défaut.
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><envar>PGPORT</envar></term>

    <listitem>
     <para>
      Port par défaut pour <xref linkend="app-psql"> (utilisé par l'option -w).
     </para>
    </listitem>
   </varlistentry>
  </variablelist>

  <para>
   Pour les autres, voir <xref linkend="app-postmaster">.
  </para>
 </refsect1>


 <refsect1>
  <title>Fichiers</title>

  <variablelist>
   <varlistentry>
    <term><filename>postmaster.pid</filename></term>

    <listitem>
     <para>
      L'existence de ce fichier dans le répertoire des données est utilisé pour
      aider <application>pg_ctl</application> à déterminer si le serveur est
      actuellement en cours d'exécution.
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><filename>postmaster.opts.default</filename></term>

    <listitem>
     <para>
      Si ce fichier existe dans le répertoire des données,
      <application>pg_ctl</application> (dans le mode <option>start</option>)
      passe le contenu du fichier comme options de la commande
      <command>postmaster</command>, sauf en cas de surcharge par l'option
      <option>-o</option>.
      Le contenu de ce fichier est aussi affiché en mode <option>status</option>     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><filename>postmaster.opts</filename></term>

    <listitem>
     <para>Si ce fichier existe dans le répertoire des données,
      <application>pg_ctl</application> (en mode <option>restart</option>)
      passe le contenu du fichier comme options de
      <application>postmaster</application>, sauf en cas de surcharge par
      l'option <option>-o</option>.
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><filename>postgresql.conf</filename></term>

    <listitem>
     <para>
      Ce fichier, situé dans le répertoire des données, est analysé pour
      trouver le bon port à utiliser avec <application>psql</application>
      lorsque <option>-w</option> est donné en mode <option>start</option>.
     </para>
    </listitem>
   </varlistentry>

  </variablelist>
 </refsect1>


 <refsect1>
  <title>Notes</title>

  <para>
   Attendre le lancement complet n'est pas une opération bien définie et
   peut échouer si le contrôle d'accès est configuré pour qu'un client
   local ne puisse pas se connecter sans interaction manuelle (par exemple, une
   authentification par mot de passe).
  </para>
 </refsect1>


 <refsect1 id="R1-APP-PGCTL-2">
  <title>Exemples</title>

  <refsect2 id="R2-APP-PGCTL-3">
   <title>Lancer le serveur</title>

   <para>
    Pour lancer un serveur&nbsp;:
<screen>
<prompt>$</prompt> <userinput>pg_ctl start</userinput>
</screen>
   </para>

   <para>
    Un exemple de lancement de serveur, bloquant tant que le serveur n'est pas
    complètement lancé&nbsp;:
<screen>
<prompt>$</prompt> <userinput>pg_ctl -w start</userinput>
</screen>
   </para>

   <para>
    Pour un serveur utilisant le port 5433 et s'exécutant sans
    <function>fsync</function>, utilisez&nbsp;:
<screen>
<prompt>$</prompt> <userinput>pg_ctl -o "-F -p 5433" start</userinput>
</screen>
   </para>
  </refsect2>

  <refsect2 id="R2-APP-PGCTL-4">
   <title>Arrêt du serveur</title>
   <para>
<screen>
<prompt>$</prompt> <userinput>pg_ctl stop</userinput>
</screen>
    arrête le serveur. Utiliser l'option <option>-m</option> vous permet de
    contrôler <emphasis>comment</emphasis> le serveur s'arrête.
   </para>
  </refsect2>

  <refsect2 id="R2-APP-PGCTL-5">
   <title>Relance du serveur</title>

   <para>
    Relancer le serveur est pratiquement équivalent à l'arrêter puis à le
    relancer de nouveau sauf que <command>pg_ctl</command> sauvegarde et
    réutilise les options en ligne de commande qui ont été passées à
    l'instance précédente. Pour relancer le serveur de la façon la plus simple,
    utilisez&nbsp;:
<screen>
<prompt>$</prompt> <userinput>pg_ctl restart</userinput>
</screen>
   </para>

   <para>
    Pour relancer le serveur, en attendant qu'il s'arrête puis qu'il se
    relance&nbsp;:
<screen>
<prompt>$</prompt> <userinput>pg_ctl -w restart</userinput>
</screen>
   </para>

   <para>
    Pour relancer en utilisant le port 5433 et en désactivant
    <function>fsync</> après redémarrage&nbsp;:
<screen>
<prompt>$</prompt> <userinput>pg_ctl -o "-F -p 5433" restart</userinput>
</screen>
   </para>
  </refsect2>

  <refsect2 id="R2-APP-PGCTL-6">
   <title>Affichage de l'état du serveur</title>

   <para>
    Voici un exemple de statut affiché à partir de
    <application>pg_ctl</application>&nbsp;:
<screen>
<prompt>$</prompt> <userinput>pg_ctl status</userinput>
<computeroutput>
pg_ctl: postmaster is running (pid: 13718)
Command line was:
/usr/local/pgsql/bin/postmaster '-D' '/usr/local/pgsql/data' '-p' '5433' '-B' '128'
</computeroutput>
</screen>
    Ceci est la ligne de commande qui serait appelée en mode relance.
   </para>
  </refsect2>
 </refsect1>


 <refsect1>
  <title>Voir aussi</title>

  <para>
   <xref linkend="app-postmaster">
  </para>
 </refsect1>

</refentry>

<!-- Keep this comment at the end of the file
Local variables:
mode:sgml
sgml-omittag:nil
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
sgml-parent-document:nil
sgml-default-dtd-file:"../reference.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:("/usr/lib/sgml/catalog")
sgml-local-ecat-files:nil
End:
-->
