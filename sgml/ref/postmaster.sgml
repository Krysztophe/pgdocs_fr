<!--
$Header: /var/lib/cvs/pgsql-fr/sgml/ref/postmaster.sgml,v 1.6 2005/03/20 22:19:41 guillaume Exp $
PostgreSQL documentation
-->

<refentry id="app-postmaster">
 <refmeta>
  <refentrytitle id="APP-POSTMASTER-TITLE"><application>postmaster</application></refentrytitle>
  <manvolnum>1</manvolnum>
  <refmiscinfo>Application</refmiscinfo>
 </refmeta>

 <refnamediv>
  <refname id="postmaster-ref">postmaster</refname>
  <refpurpose>serveur de bases de données multiutilisateur
   <productname>PostgreSQL</productname></refpurpose>
 </refnamediv>

 <indexterm zone="app-postmaster">
  <primary>postmaster</primary>
 </indexterm>

 <refsynopsisdiv>
  <cmdsynopsis>
   <command>postmaster</command>
   <arg>-A <group choice="plain"><arg>0</arg><arg>1</arg></group></arg>
   <arg>-B <replaceable>nombre_de_tampons</replaceable></arg>
   <arg>-c
<replaceable>nom</replaceable>=<replaceable>valeur</replaceable></arg>
   <arg>-d <replaceable>niveau_de_débogage</replaceable></arg>
   <arg>-D <replaceable>répertoire_données</replaceable></arg>
   <arg>-F</arg>
   <arg>-h <replaceable>nom_hôte</replaceable></arg>
   <arg>-i</arg>
   <arg>-k <replaceable>répertoire</replaceable></arg>
   <arg>-l</arg>
   <arg>-N <replaceable>nombre_max_connexions</replaceable></arg>
   <arg>-o <replaceable>options_supplémentaires</replaceable></arg>
   <arg>-p <replaceable>port</replaceable></arg>
   <arg>-S</arg>
   <arg>--<replaceable>nom</replaceable>=<replaceable>valeur</replaceable></arg>
   <group><arg>-n</arg><arg>-s</arg></group>
  </cmdsynopsis>
 </refsynopsisdiv>

 <refsect1>
  <title>Description</title>

  <para>
   <command>postmaster</command> est le serveur de bases de données
   multi-utilisateurs <productname>PostgreSQL</productname>. Pour qu'une
   application cliente accède à une base de données, il se connecte (via le
   réseau ou localement) à un <command>postmaster</command> en cours
   d'exécution. Ensuite, le <command>postmaster</command> lance un processus
   serveur séparé (<quote><xref linkend="app-postgres"></quote>) pour gérer la
   connexion. Le <command>postmaster</command> gère aussi la communication parmi
   les processus du serveur.
  </para>

  <para>
   Par défaut, le <command>postmaster</command> lance dans l'entrée et affiche
   les messages des traces dans le flux standard des erreurs. Dans les
   applications pratiques, le <command>postmaster</command> devrait être lancé
   comme processus d'arrière-plan, peut-être au démarrage.
  </para>

  <para>
   Un <command>postmaster</command> gère toujours les données à partir
   d'exactement un groupe de bases de données. Ce groupe est une collection de
   bases de données qui est stockée sur un emplacement commun du système de
   fichiers (l'<quote>aire des données</quote>). Plus d'un processus
   <command>postmaster</command> peut se lancer sur un système à la fois, s'ils
   utilisent des aires de données et des ports différents (voir ci-dessous). Une
   aire de données est créée avec <xref linkend="app-initdb">.
  </para>

  <para>
   Quand le <command>postmaster</command> se lance, il a besoin de connaître
   l'emplacement de l'aire des données. L'emplacement doit être indiqué avec
   l'option <option>-D</option> ou la variable d'environnement
   <envar>PGDATA</envar>&nbsp;; il n'existe pas de valeurs par défaut.
   Typiquement, <option>-D</option> ou <envar>PGDATA</envar> pointe directement
   vers le répertoire des données créé par <application>initdb</>. D'autres
   configurations possibles du fichier sont discutés dans <xref
   linkend="runtime-config-file-locations">.
  </para>
 </refsect1>

 <refsect1 id="app-postmaster-options">
  <title>Options</title>

   <para>
    <command>postmaster</command> accepte les arguments suivants en ligne de 
    commande. Pour une discussion détaillée des options, consultez <xref
    linkend="runtime-config">. Vous pouvez aussi sauvegarder une saisie de la
    plupart des options en initialisant un fichier de configuration.
    
    <variablelist>
     <varlistentry>
      <term><option>-A 0|1</option></term>
      <listitem>
       <para>
        Active les vérifications d'assertion en exécution, qui est une aide de
	débogage pour détecter les erreurs de programmation. Cette option est
	seulement disponible si elle était activée lors de la compilation de
	<productname>PostgreSQL</productname>. Dans ce cas, la valeur par défaut
	est <quote>on</quote>.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-B <replaceable
	class="parameter">nombre_tampons</replaceable></option></term>
      <listitem>
       <para>
	Initialise le nombre des tampons partagés utilisés par les processus
	serveur. La valeur par défaut de ce paramètre est choisi par
	<application>initdb</application>&nbsp;; référez-vous à <xref
	linkend="runtime-config-resource-memory"> pour plus
	d'informations.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-c
	<replaceable>nom</replaceable>=<replaceable>valeur</replaceable></option>
</term>
      <listitem>
       <para>
        Configure un paramètre nommé en exécution. Les paramètres de
	configuration supportés par <productname>PostgreSQL</productname> sont
	décrits dans <xref linkend="runtime-config">. La plupart
	des autres options en ligne de commande sont en fait des formes courtes
	de ces affectations de paramètres. <option>-c</> peut apparaître
	plusieurs fois pour initialiser plusieurs paramètres.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-d
	<replaceable>niveau_de_débogage</replaceable></option></term>
      <listitem>
       <para>
        Initialise le niveau de débogage. Plus cette valeur est haute, plus la
	sortie de débogage est importante. Les valeurs vont de 1 to 5.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-D <replaceable
	class="parameter">répertoire_de_données</replaceable></option></term>
      <listitem>
       <para>
	Spécifie l'emplacement du système de fichiers du répertoire de données
	et des fichiers de configuration. Voir  <xref
	linkend="runtime-config-file-locations"> pour plus de détails 
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-F</option></term>
      <listitem>
       <para>
        Désactive les appels à <function>fsync</function> pour les améliorations
	de performance au risque d'une corruption de données dans le cas d'un
	arrêt brutal du système. Cette option est équivalente à désactiver le
	paramètre de configuration <xref linkend="guc-fsync">. Lire la
	documentation détaillée avant d'utiliser ceci&nbsp;!
       </para>

       <para>
        <option>--fsync=true</option> a l'effet contraire de cette option.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-h <replaceable
	class="parameter">nom_hôte</replaceable></option></term>
      <listitem>
       <para>
	Spécifie le nom d'hôte ou l'adresse IP sur lequel le
	<command>postmaster</command> est en attente de connexions TCP/IP
	provenant des applications clientes. La valeur peut aussi être une 
	liste d'adresses séparées par un espace ou <literal>*</> pour indiquer
	d'écouter sur toutes les interfaces disponibles. Une valeur vide
	indique de ne pas écouter les adresses IP, auquel cas seuls les sockets
	de domaine Unix peuvent être utilisés pour se connecter au
	<command>postmaster</command>. Par défaut, écoute seulement sur
	<systemitem class="systemname">localhost</systemitem>. Spécifier cette
	option est équivalent à configurer le paramètre <xref
	linkend="guc-listen-addresses">.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-i</option></term>
      <listitem>
       <para>
        Autorise la connexion TCP/IP (Internet domain) des clients distants.
	Sans cette option, seules les connexions locales sont acceptées. Cette
	option correspond à la configuration <literal>tcpip_socket=true</> dans
	<filename>postgresql.conf</>.
       </para>
       <para>
	Cette option est obsolète car elle ne permet pas d'accèder à toutes les
	possibilités de <xref linkend="guc-listen-addresses">. Il est
	généralement mieux de configurer <varname>listen_addresses</>
	directement.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-k <replaceable
	class="parameter">répertoire</replaceable></option></term>
      <listitem>
       <para>
	Spécifie le répertoire du socket de domaine Unix sur lequel le
	<command>postmaster</command> écoute les connexions des applications
	clientes. La valeur par défaut est normalement
	<filename>/tmp</filename> mais peut être modifié au moment de la
	construction.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-l</option></term>
      <listitem>
       <para>
	Active les connexions sécurisées utilisant <acronym>SSL</acronym>.
	<productname>PostgreSQL</productname> doit avoir été compilé avec le
	support pour <acronym>SSL</acronym> pour que cette option soit
	disponible. Pour plus d'informations sur l'utilisation de
	<acronym>SSL</acronym>, référez-vous à <xref linkend="ssl-tcp">.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-N <replaceable
	class="parameter">nombre_max_connexions</replaceable></option></term>
      <listitem>
       <para>
	Initialise le nombre maximum de connexions clientes que ce
	<command>postmaster</command> acceptera. Par défaut, cette valeur est
	32 mais il peut être initialisé aussi haut que ce que votre système
	supportera. (Notez que <option>-B</option> est requis pour être au moins
	deux fois la valeur de <option>-N</option>. Voir <xref
	linkend="kernel-resources"> pour une discussion des besoins de
	ressources système pour un grand nombre de connexions clientes.)
	Spécifier cette option est équivalent à configurer le paramètre
	<xref linkend="guc-max-connections">.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-o <replaceable
	class="parameter">options_supplémentaires</replaceable></option></term>
      <listitem>
       <para>
	Les options spécifiées en ligne de commande dans <replaceable
	class="parameter">options_supplémentaires</replaceable> sont passées à
	tous les processus serveur lancés par ce <command>postmaster</command>.
	Voir <xref linkend="app-postgres"> pour les possibilités. Si la chaîne
	d'option contient des espaces, la chaîne entière doit être entre
	guillemets.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-p <replaceable
class="parameter">port</replaceable></option></term>
      <listitem>
       <para>
	Spécifie le port TCP/IP ou l'extension du fichier socket de domaine
	Unix local sur lequel écoute le <command>postmaster</command> pour les
	connexions des applications clientes. A pour défaut la valeur de la
	variable d'environnement <envar>PGPORT</envar> ou, si
	<envar>PGPORT</envar> n'est pas configurée, alors il a pour valeur par
	défaut la valeur établie lors de la compilation (normalement 5432). Si
	vous spécifiez un port autre que celui par défaut, alors toutes les
	applications clientes doivent spécifier le même port en utilisant soit
	les options en ligne de commande soit <envar>PGPORT</envar>.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
      <term><option>-S</option></term>
      <listitem>
       <para>
	Spécifie que le processus <command>postmaster</command> devrait se
	lancer en mode silencieux. C'est-à-dire qu'il sera dissocié du terminal
	(de contrôle) de l'utilisateur, lancé dans son propre groupe de
	processus et redirige sa propre sortie standard et sa propre sortie
	standard des erreurs vers <filename>/dev/null</filename>.
       </para>
       <para>
        Utiliser cette option désactive tous les messages de traces, ce qui
	n'est probablement pas ce que vous souhaitez car cela rend le débogage
	très difficile. Voir ci-dessous pour un meilleur moyen de lancer
	<command>postmaster</command> en tâche de fond.
       </para>
       <para>
        <option>--silent-mode=false</option> a l'effet opposé de cette option.
       </para>
      </listitem>
     </varlistentry>

     <varlistentry>
     
<term><option>--<replaceable>nom</replaceable>=<replaceable>valeur</replaceable>
</option></term>
      <listitem>
       <para>
        Initialise un paramètre nommé en exécution&nbsp;; une forme courte de
        <option>-c</>.
       </para>
      </listitem>
     </varlistentry>

    </variablelist>
   </para>

   <para>
    Deux options supplémentaires en ligne de commande sont disponibles pour les
    problèmes de débogage causant l'arrêt anormal d'un processus de serveur. La
    stratégie ordinaire dans cette situation est de notifier tous les autres
    processus serveur qu'ils doivent se terminer et réinitialiser ensuite la
    mémoire partagée et les sémaphores. Ceci est dû au fait qu'un processus
    serveur errant peut avoir corrompu quelques états partagés avant de se
    terminer. Ces options sélectionnent des comportements alternatifs de
    <command>postmaster</command> dans cette situation. <emphasis>Aucune de ces
    options a pour but d'utiliser une opération ordinaire.</emphasis>
   </para>

   <para>
   </para>

   <para>
    Ces options de cas spéciaux sont&nbsp;:

    <variablelist>
     <varlistentry>
      <term><option>-n</option></term>
      <listitem>
       <para>
	<command>postmaster</command> réinitialisera les structures de données
	partagées. Un développeur de système de connaissances peut alors
	utiliser un débogueur pour examiner l'état des mémoires partagées et des
	sémaphores.
       </para>
     </listitem>
    </varlistentry>

    <varlistentry>
      <term><option>-s</option></term>
      <listitem>
       <para>
	<command>postmaster</command> stoppera tous les autres processus
	serveur en envoyant le signal <literal>SIGSTOP</literal> mais ne les
	empêchera pas de terminer. Ceci permet aux développeurs système de
	récupérer les <quote>core dump</quote> à partir de tous les processus
	serveur manuellement.
       </para>
      </listitem>
     </varlistentry>
    </variablelist>
   </para>

 </refsect1>

 <refsect1>
  <title>Environnement</title>

  <variablelist>
   <varlistentry>
    <term><envar>PGCLIENTENCODING</envar></term>

    <listitem>
     <para>
      Codage des caractères par défaut utilisé par les clients. (Les clients
      pourraient surcharger ceci individuellement.) Cette valeur peut aussi être
      dans le fichier de configuration.
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><envar>PGDATA</envar></term>

    <listitem>
     <para>
      Emplacement par défaut du répertoire de direction
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><envar>PGDATESTYLE</envar></term>

    <listitem>
     <para>
      Valeur par défaut du paramètre <xref linkend="guc-datestyle"> en
      exécution. (L'utilisation de cette variable d'environnement est obsolète.)
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><envar>PGPORT</envar></term>

    <listitem>
     <para>
      Port par défaut (de préférence, initialisé dans le fichier de
      configuration)
     </para>
    </listitem>
   </varlistentry>

   <varlistentry>
    <term><envar>TZ</envar></term>

    <listitem>
     <para>
      Fuseau horaire du serveur
     </para>
    </listitem>
   </varlistentry>

  </variablelist>
 </refsect1>

 <refsect1>
   <title>Diagnostiques</title>

   <para>
    Un message d'échec mentionnant <literal>semget</> ou <literal>shmget</>
    indique probablement que vous avez besoin de configurer votre noyau pour
    fournir les mémoires partagées et sémaphores adéquats. Pour plus de
    discussion, voir <xref linkend="kernel-resources">.
   </para>

   <tip>
    <para>
     Vous devriez être capable de reconfigurer votre noyau en décrémentant
     <xref linkend="guc-shared-buffers"> pour réduire la consomnation de mémoire
     partagée de <productname>PostgreSQL</> et/ou en réduisant
     <xref linkend="guc-max-connections"> pour réduire la consomnation de
     sémaphores.
    </para>
   </tip>

   <para>
    Un message d'échec suggérant qu'un autre postmaster est en cours
    d'exécution devrait être vérifié avec attention, par exemple en utilisant la
    commande
<screen>
<prompt>$</prompt> <userinput>ps ax | grep postmaster</userinput>
</screen>
        ou
<screen>
<prompt>$</prompt> <userinput>ps -ef | grep postmaster</userinput>
</screen>
    suivant votre système. Si vous êtes certain qu'aucun postmaster en
    conflit n'est en cours d'exécution, vous pourriez supprimer le fichier
    verrou mentionné dans le message et tenter de nouveau.
   </para>

   <para>
    Un message d'échec indiquant l'incapacité à lier un port pourrait indiquer
    que ce port est déjà utilisé par un processus autre que le serveur
    <productname>PostgreSQL</productname>. Vous pourriez obtenir cette erreur si
    vous terminez le <command>postmaster</command> et si vous le relanciez
    immédiatement en utilisant le même port&nbsp;; dans ce cas, vous devez
    simplement attendre quelques secondes jusqu'à ce que le système
    d'exploitation ferme le port avant de ré-essayer. Finalement, vous pourriez
    obtenir cette erreur si vous spécifiez un numéro de port que votre système
    d'exploitation considère comme réservé. Par exemple, un grand nombre de
    versions d'Unix considère les numéros de port sous le numéro 1024 pour être
    en <quote>confiance</quote> et permet seulement l'accès par le
    superutilisateur Unix.
   </para>

 </refsect1>

 <refsect1>
  <title>Notes</title>

  <para>
   Si c'est possible, <emphasis>ne pas</emphasis> utiliser
   <literal>SIGKILL</literal> pour tuer le processus
   <command>postmaster</command>. Le faire ainsi empêchera
   <command>postmaster</command> de libérer les ressources du système
   (c'est-à-dire les mémoires partagées et les sémaphores) qu'il détient avant
   de terminer. Ceci pourrait causer des problèmes de lancement d'un processus
   <command>postmaster</command> réel.
  </para>

  <para>
   Pour terminer normalement <command>postmaster</command>, les signaux
   <literal>SIGTERM</literal>, <literal>SIGINT</literal> ou 
   <literal>SIGQUIT</literal> peuvent être utilisés. Le premier attendra
   l'arrêt de tous les clients avant de quitter, le second déconnectera en force
   tous les clients et le troisième quittera immédiatement sans arrêt propre
   résultant dans le lancement d'une récupération lors du redémarrage. Le signal
   <literal>SIGHUP</literal> rechargera les fichiers de configuration du
   serveur.
  </para>

  <para>
   La commande outil <xref linkend="app-pg-ctl"> peut être utilisée pour
   démarrer et arrêter le <command>postmaster</command> en toute sûreté et
   confortablement.
  </para>

  <para>
   Les options <option>--</> ne fonctionneront pas sur <systemitem
   class="osname">FreeBSD</> ou <systemitem class="osname">OpenBSD</>. Utilisez
   <option>-c</> à la place. Ceci est un bogue dans les systèmes d'exploitation
   affectés&nbsp;; une prochaine version de
   <productname>PostgreSQL</productname> fournira un contournement si ceci
   n'est pas corrigé.
  </para>

 </refsect1>

 <refsect1 id="app-postmaster-examples">
  <title>Exemples</title>
  <para>
   Pour lancer <command>postmaster</command> en tâche de fond en utilisant les
valeurs par défaut, saisissez&nbsp;:

<screen>
<prompt>$</prompt> <userinput>nohup postmaster &gt;logfile 2&gt;&amp;1 &lt;/dev/null &amp;</userinput>
</screen>
  </para>

  <para>
   Pour lancer <command>postmaster</command> sur un port spécifique&nbsp;:
<screen>
<prompt>$</prompt> <userinput>postmaster -p 1234</userinput>
</screen>
   Cette commande lancera un <command>postmaster</command> communiquant via le
   port 1234. Pour se connecter à ce <command>postmaster</command> en utilisant
   <application>psql</>, vous aurez besoin de lancer par exemple
<screen>
<prompt>$</prompt> <userinput>psql -p 1234</userinput>
</screen>
   ou d'initialiser la variable d'environnement <envar>PGPORT</envar>&nbsp;:
<screen>
<prompt>$</prompt> <userinput>export PGPORT=1234</userinput>
<prompt>$</prompt> <userinput>psql</userinput>
</screen>
  </para>

  <para>
   Les paramètres nommés en exécution peuvent être configuré avec un des styles
   suivant&nbsp;:
<screen>
<prompt>$</prompt> <userinput>postmaster -c work_mem=1234</userinput>
<prompt>$</prompt> <userinput>postmaster --work-mem=1234</userinput>
</screen>
   Chaque forme surcharge le paramètrage pouvant exister pour
   <varname>work_mem</> dans <filename>postgresql.conf</>. Notez que les tirets
   bas dans les noms de paramètre peuvent être écrits soit avec un tiret bas
   soit avec un tiret sur la ligne de commande.
  </para>

  <tip>
  <para>
   Sauf dans le cas d'expérimentations à court terme, une meilleure pratique
   est d'éditer le paramètrage dans <filename>postgresql.conf</> plutôt que de
   se fier à l'option en ligne de commande plutôt qu'à un paramètre.
  </para>
  </tip>
 </refsect1>

 <refsect1>
  <title>Voir aussi</title>

  <para>
   <xref linkend="app-initdb">,
   <xref linkend="app-pg-ctl">
  </para>
 </refsect1>
</refentry>

<!-- Keep this comment at the end of the file
Local variables:
mode: sgml
sgml-omittag:nil
sgml-shorttag:t
sgml-minimize-attributes:nil
sgml-always-quote-attributes:t
sgml-indent-step:1
sgml-indent-data:t
sgml-parent-document:nil
sgml-default-dtd-file:"../reference.ced"
sgml-exposed-tags:nil
sgml-local-catalogs:"/usr/lib/sgml/catalog"
sgml-local-ecat-files:nil
End:
-->
